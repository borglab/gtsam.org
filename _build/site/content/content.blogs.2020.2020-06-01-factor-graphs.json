{"version":1,"kind":"Article","sha256":"3353f00c57c93de9943ba493a81d69589fbed3bcd04370f2455854b43b739340","slug":"content.blogs.2020.2020-06-01-factor-graphs","location":"/Content/Blogs/2020/2020-06-01-factor-graphs.md","dependencies":[],"frontmatter":{"title":"What are Factor Graphs?","authors":[{"nameParsed":{"literal":"Frank Dellaert","given":"Frank","family":"Dellaert"},"name":"Frank Dellaert","twitter":"https://x.com/fdellaert","url":"https://dellaert.github.io/","id":"contributors-2020-06-01-factor-graphs-generated-uid-0"}],"date":"2020-06-01","github":"https://github.com/borglab/gtsam","numbering":{"title":{"offset":2}},"edit_url":"https://github.com/borglab/gtsam/blob/docs/ktk-sdk/Content/Blogs/2020/2020-06-01-factor-graphs.md","thumbnail":"/image6-7ea8b13accffca8448244134fb602450.png","exports":[{"format":"md","filename":"2020-06-01-factor-graphs.md","url":"/2020-06-01-factor-gr-a00145a68c2ffcb7666fc93694c9015f.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Many computational problems in robotics have an optimization problem at their core. For example, in simultaneous localization and mapping (SLAM) and many other ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"ealLUPfZcB"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"estimation problems","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"nZMmvTctjf"}],"key":"yeXGS1YbXW"},{"type":"text","value":" we are after a maximum a posteriori estimate, i.e., we try to maximize posterior probability of the variables given a set of measurements. When attempting to ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"oEYaaBeudI"},{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"act optimally","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Y99FyCzivG"}],"key":"Betz4zG7kf"},{"type":"text","value":", we try to maximize a performance index, or conversely minimize a penalty function. And even in classical planning, we are trying to find an assignment to a set of discrete variables that minimizes the plan length or optimizes for some other desirable property of the plan.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"KqQq6YAOFt"}],"key":"HzxDgq0253"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"In most of these optimization problems, the objective to be maximized or minimized is composed of many different ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"oHjx7NI8gg"},{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"factors or terms that typically are local in nature","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"qDjXFzrYv7"}],"key":"dw8dEIqB88"},{"type":"text","value":", i.e., they only depend on a small subset of the entire set of variables. For example, in a tracking application, a particular video frame only provides information about the position of a target at a particular time. At the next time step, a different variable is associated with the target. Of course, this depends on the parametrization chosen: if a track is globally parametrized, for example as a polynomial, this locality is destroyed.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"vAF6hI07nP"}],"key":"CZC4JSiJBw"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"A particularly insightful way of modeling this locality structure is using the concept of ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"eCiJgU0hg4"},{"type":"strong","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"factor graphs","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"BGdIAKIwQQ"}],"key":"Nz5U09Ay1w"},{"type":"text","value":". Factor graphs are a class of graphical models in which there are variables and factors. The variables represent unknown quantities in the problem, and the factors represent functions on subsets of the variables. Edges in the factor graph are always between factors and variables, and indicate that a particular factor depends on a particular variable.","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"Mxgk8DbbLf"}],"key":"itGukQc26f"},{"type":"paragraph","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"There are three main ","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"XrDHUp4VlM"},{"type":"strong","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"advantages","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"X08zqzMH6u"}],"key":"EHDp1O4AC4"},{"type":"text","value":" to using factor graphs when designing algorithms for robotics applications:","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"cUbbRxFS0q"}],"key":"cNFgJak7sg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"They can represent a wide variety of problems across robotics.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"vQvJ0VExl9"}],"key":"wRkPt8M8wJ"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"By laying bare the compositional structure of the problem, they expose opportunities to improve computational performance.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"afR1t2SSKZ"}],"key":"VUsJAj4TqD"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"They are beneficial in designing and thinking about modelling your problem, even aside from performance considerations.","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"aH805LC77E"}],"key":"shZESalZvq"}],"key":"OliwnVYBQO"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Because many optimization problems in robotics have the locality property, factor graphs can model a wide variety of problems across AI and robotics. Some of these are illustrated below:","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"oTSIgIQdlY"}],"key":"hOlCZA0LKz"},{"type":"heading","depth":2,"position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Boolean Satisfiability","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"mmNhRBHLsN"}],"identifier":"boolean-satisfiability","label":"Boolean Satisfiability","html_id":"boolean-satisfiability","implicit":true,"key":"aDjqRMGING"},{"type":"paragraph","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"In ","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"EQbTi0hzBi"},{"type":"emphasis","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"Boolean Satisfiability","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"ZjRiPzAi7B"}],"key":"FP6afX6Ky9"},{"type":"text","value":", we are looking for an assignment to Boolean variables that make a set of Boolean formulas true. In the example below, the rather boring looking Boolean equations is represented by the Boolean factor graph below:","position":{"start":{"line":25,"column":1},"end":{"line":25,"column":1}},"key":"yhh062cR7F"}],"key":"xksNdMIXsN"},{"type":"image","url":"/image6-7ea8b13accffca8448244134fb602450.png","alt":"Factor graph with Boolean variables and hard constraints","title":"Factor graph with Boolean variables and hard constraints","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"jTimjIBpBH","urlSource":"/_static/fg-images/image6.png"},{"type":"heading","depth":2,"position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Constraint Satisfaction","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"RqJTsXTtGT"}],"identifier":"constraint-satisfaction","label":"Constraint Satisfaction","html_id":"constraint-satisfaction","implicit":true,"key":"BZrhH6apzG"},{"type":"paragraph","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"When we generalize from Boolean to ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"OdumABeX9f"},{"type":"emphasis","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"discrete","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"pUogUyviYR"}],"key":"qrUZ0Rv2NZ"},{"type":"text","value":" variables, we obtain the class of ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"LOZQpnPNgx"},{"type":"emphasis","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"Constraint Satisfaction Problems","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"qC0wTSR0kv"}],"key":"GbgOT2x9N2"},{"type":"text","value":" or CSPs. For example, the image below shows a graph coloring problem where the goal is to assign a color (chosen from a finite set of colors) to the Swiss cantons such that no neighboring canton has the same color. In the graph below, these pairiwse ","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"M4ThKPP3dZ"},{"type":"emphasis","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"constraints","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"q7Zmi3zSh2"}],"key":"PySxtFNW5w"},{"type":"text","value":" are indicated by the square factors.","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"HXGtuiDaIb"}],"key":"OtWqO4w6oH"},{"type":"image","url":"/image3-579f9c518a1366512f56bd1fe8a8c2b8.png","alt":"Factor graph with Discrete variables and hard constraints","title":"Factor graph with Discrete variables and hard constraints","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"hmZvLCGuzE","urlSource":"/_static/fg-images/image3.png"},{"type":"heading","depth":2,"position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"Bayes Networks","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"Ne4HHcGVGF"}],"identifier":"bayes-networks","label":"Bayes Networks","html_id":"bayes-networks","implicit":true,"key":"R5SvWulD3Z"},{"type":"paragraph","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"If we relax the hard constraints to real-valued ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"SUD4ifS5c4"},{"type":"emphasis","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"preferences","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"HrMkF67a7U"}],"key":"ln8PBuHeza"},{"type":"text","value":", we switch to a ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"WH3IQeNYbR"},{"type":"emphasis","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Constraint Optimization Problem","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"vZnizovcX9"}],"key":"nEUCiOp33y"},{"type":"text","value":". This can be used to express that a particular color is preferred over another one. It can be shown that ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"o7cfUBxQXX"},{"type":"emphasis","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"COPs","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"WffhorCJ5j"}],"key":"HpX5EyjsHI"},{"type":"text","value":" are also the main optimization problem to solve in the venerable AI technique of ","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"BsLQN2fgrC"},{"type":"emphasis","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"children":[{"type":"text","value":"Bayes networks","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"Do8yZteuYn"}],"key":"BoujwmpNAK"},{"type":"text","value":". Below an example where a Bayes network with given evidence (the square nodes) is converted to a COP factor graph, which can then give the maximum probable explanation for the remaining (non-evidence) variables.","position":{"start":{"line":38,"column":1},"end":{"line":38,"column":1}},"key":"aM6sJhFlrv"}],"key":"gImBzytRSv"},{"type":"image","url":"/image5-f7175fb1425df8ae61774dbd30b8b4c8.png","alt":"Bayes net with evidence and corresponding COP factor graph","title":"Bayes net with evidence and corresponding COP factor graph","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"nINix90yze","urlSource":"/_static/fg-images/image5.png"},{"type":"heading","depth":2,"position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Polynomial Equations","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"MQ2GTenebE"}],"identifier":"polynomial-equations","label":"Polynomial Equations","html_id":"polynomial-equations","implicit":true,"key":"SnCPxwA2DV"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"The constraints can also be other functions of the variables. For example, we can represent a system of polynomial equations by a factor graph. The example below, adapted from Gim Hee Lee’s Ph.D. thesis, encodes a minimal geometry problem from computer vision, useful for autonomous driving:","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"JnFwyDnoxZ"}],"key":"hsq7172n5C"},{"type":"image","url":"/image2-196d3872fd7f25428754beb817370dfb.png","alt":"Factor graph with continuous variables and polynomial equality constraints","title":"Factor graph with continuous variables and polynomial equality constraints","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"eT8NJD0iEc","urlSource":"/_static/fg-images/image2.png"},{"type":"heading","depth":2,"position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"Simultaneous Localization and Mapping","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"D0emm1BRbz"}],"identifier":"simultaneous-localization-and-mapping","label":"Simultaneous Localization and Mapping","html_id":"simultaneous-localization-and-mapping","implicit":true,"key":"EH7RHop9ZC"},{"type":"paragraph","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Speaking of autonomous driving, perhaps the most famous application of factor graphs is in SLAM, or ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"dekPIkQvuW"},{"type":"emphasis","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Simultaneous Localization and Mapping","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"Gafwb3dk1x"}],"key":"CBCDrOGeSO"},{"type":"text","value":". This is illustrated in the example below, where the location of a vehicle over time (the cyan variables) as well as the location of a set of landmarks (the dark blue nodes) are solved for. In this case we have a plethora of factors associated with vehicle odometry, landmark sightings, and GPS priors. The example in question is a small excerpt from a real robot experiment in Sydney’s Victoria Park.","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"uUHyqKB4hw"}],"key":"PxrQan1ZUK"},{"type":"image","url":"/image1-f0391b980e75c3788a3967bae762b8e0.png","alt":"Factor graph with pose and landmark variables, and measurement-derived factors","title":"Factor graph with pose and landmark variables, and measurement-derived factors","position":{"start":{"line":55,"column":1},"end":{"line":55,"column":1}},"key":"cLWFH6NvLw","urlSource":"/_static/fg-images/image1.png"},{"type":"heading","depth":2,"position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"Structure from Motion","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"utxD7lQY8F"}],"identifier":"structure-from-motion","label":"Structure from Motion","html_id":"structure-from-motion","implicit":true,"key":"ngEx8Ql56u"},{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"Finally, we can also represent ","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"IORa7Nw6mH"},{"type":"emphasis","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"3D mapping","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"nA21pRfBlN"}],"key":"iTJjMTPMnH"},{"type":"text","value":" or ","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"Jh0dUpKtmn"},{"type":"emphasis","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"3D reconstruction","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"IZtsMFlxBN"}],"key":"TTNjHGfH8a"},{"type":"text","value":" problems with factor graphs. Below we show just the edges in the factor graph connecting one camera (yellow) with all points visible from that camera (black) in a large-scale 3D reconstruction of downtown Chicago.","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"aN77JxKWdb"}],"key":"r7pCqxiXE7"},{"type":"image","url":"/image4-d022c45986a50fe5f0a2b59fcbea38c1.png","alt":"Factor graph with cameras and 3D point variables, and re-projection factors for one camera","title":"Factor graph with cameras and 3D point variables, and re-projection factors for one camera","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"TDPVQw1Djq","urlSource":"/_static/fg-images/image4.png"},{"type":"heading","depth":2,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Conclusion","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"Hav1QjPBq5"}],"identifier":"conclusion","label":"Conclusion","html_id":"conclusion","implicit":true,"key":"fOqOj8YPEh"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"For more information about how factor graphs are typically used to solve perception problems in robotics, see the following booklet: ","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"LGh9JQjcTw"},{"type":"link","url":"https://dellaert.github.io/files/Dellaert17fnt.pdf","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"Factor graphs for robot perception","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"PzNJb9ZiQn"}],"urlSource":"https://dellaert.github.io/files/Dellaert17fnt.pdf","key":"K9XoMMidtw"},{"type":"text","value":", by ","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"fzo6hCxJ6U"},{"type":"link","url":"https://dellaert.github.io","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"Frank Dellaert","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"NnJJPP5Pp4"}],"urlSource":"https://dellaert.github.io","key":"rzBB0ga9NB"},{"type":"text","value":" and ","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"c3ZKGH7ToO"},{"type":"link","url":"https://frc.ri.cmu.edu/~kaess/","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"Michael Kaess","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"RhrPQ4nzEG"}],"urlSource":"https://frc.ri.cmu.edu/~kaess/","key":"de5nwiv0H1"},{"type":"text","value":", which appeared in 2017 in Foundations and Trends in Robotics.","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"KFRmJYmGst"}],"key":"nqU4uOzeZg"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"However, this is just the tip of the iceberg. Factor graphs can be used to model a much wider variety of problems across robotics domains, such as Tracking, Inertial Navigation, Mapping with LIDARs, Classical Planning, Reinforcement Learning and Optimal Control, Motion Planning etc...","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"dddbeXUURS"}],"key":"TVZRNJoFFv"}],"key":"JV01mjx9KD"}],"key":"S3LWf4qZ7H"},"references":{"cite":{"order":[],"data":{}}}}