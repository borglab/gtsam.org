{"version":1,"kind":"Article","sha256":"9cfe997bab33ad88186b78d8c99f8f2b1bd0bd810f29acfe870c675d4c9e47cc","slug":"content.blogs.2019.2019-11-07-lqr-control","location":"/Content/Blogs/2019/2019-11-07-lqr-control.md","dependencies":[],"frontmatter":{"title":"LQR Control Using Factor Graphs","authors":[{"nameParsed":{"literal":"Gerry Chen","given":"Gerry","family":"Chen"},"name":"Gerry Chen","url":"https://gerry-chen.com","id":"contributors-2019-11-07-lqr-control-generated-uid-0"},{"nameParsed":{"literal":"Yetong Zhang","given":"Yetong","family":"Zhang"},"name":"Yetong Zhang","url":"https://www.linkedin.com/in/yetong-zhang-9b810a105/)","id":"contributors-2019-11-07-lqr-control-generated-uid-1"},{"nameParsed":{"literal":"Frank Dellaert","given":"Frank","family":"Dellaert"},"name":"Frank Dellaert","url":"https://www.cc.gatech.edu/~dellaert/FrankDellaert/Frank_Dellaert/Frank_Dellaert.html","id":"contributors-2019-11-07-lqr-control-generated-uid-2"}],"date":"2019-11-02","github":"https://github.com/borglab/gtsam","numbering":{"title":{"offset":2}},"edit_url":"https://github.com/borglab/gtsam/blob/docs/ktk-sdk/Content/Blogs/2019/2019-11-07-lqr-control.md","thumbnail":"/fg_lqr-45a66a1ef4b5cd1cb47546323a28a9e7.png","exports":[{"format":"md","filename":"2019-11-07-lqr-control.md","url":"/2019-11-07-lqr-contr-d67fedb923c23a2d209ec865a55f0f81.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"comment","value":" horizontal scrolling ","key":"pgka2Yl8rh"},{"type":"comment","value":" - TOC\n{:toc} ","key":"LvkGHsXnNU"},{"type":"heading","depth":2,"position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"Uxr4tAMKu4"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"igKeqUf99Z"},{"type":"container","kind":"figure","children":[{"type":"image","url":"/fg_lqr-45a66a1ef4b5cd1cb47546323a28a9e7.png","alt":"Factor graph structure for an LQR problem with 3 time steps. The cost factors are marked with dashed lines and the dynamics constraint factors are marked with solid lines.","align":"center","data":{"altTextIsAutoGenerated":true},"key":"YYnDKrRGTv","urlSource":"/_static/lqr_control/VE/fg_lqr.png"},{"type":"caption","children":[{"type":"paragraph","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"children":[{"type":"captionNumber","kind":"figure","label":"Figure 1","identifier":"figure 1","html_id":"figure-1","enumerator":"1","children":[{"type":"text","value":"Figure ","key":"obKTS9Ken7"},{"type":"text","value":"1","key":"xYtl2PdIgo"},{"type":"text","value":":","key":"mN17Lq1Sqr"}],"template":"Figure %s:","key":"ZuJNZQaWjD"},{"type":"text","value":"Factor graph structure for an LQR problem with 3 time steps. The cost factors are marked with dashed lines and the dynamics constraint factors are marked with solid lines.","position":{"start":{"line":47,"column":1},"end":{"line":47,"column":1}},"key":"jAmnw0osXN"}],"key":"Q2drLGVWI1"}],"key":"oiVuVxT7w3"}],"label":"Figure 1","identifier":"figure 1","enumerator":"1","html_id":"figure-1","key":"PQ3nlbJhPO"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":51,"column":1}},"children":[{"type":"text","value":"In this post we explain how optimal control problems can be formulated as factor graphs and solved\nby performing variable elimination on the factor graph.","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"DQZAUEkcr8"}],"key":"AHNCvOLhqh"},{"type":"paragraph","position":{"start":{"line":53,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Specifically, we will show the factor graph formulation and solution for the\n","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"DVoNAOzs68"},{"type":"strong","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"Linear Quadratic Regulator (LQR)","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"fzq7BNCjMZ"}],"key":"aNhfgWXrN3"},{"type":"text","value":".  LQR is ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"c5WWGBK3uY"},{"type":"emphasis","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"children":[{"type":"text","value":"a state feedback controller which derives the optimal gains\nfor a linear system with quadratic costs on control effort and state error","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"Cs1LGbijJn"}],"key":"o9l6WotV74"},{"type":"text","value":".","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"s2IDgIK36q"}],"key":"zDsEXfwy9F"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"We consider the ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"G3mLkjc5UC"},{"type":"link","url":"https://stanford.edu/class/ee363/lectures/dlqr.pdf","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"strong","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"finite-horizon, discrete LQR\nproblem","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"I016T55x7N"}],"key":"FH2mAMR7I8"}],"urlSource":"https://stanford.edu/class/ee363/lectures/dlqr.pdf","key":"PclQdry6Y4"},{"type":"text","value":".\nThe task is to ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"HYGJw5ox9G"},{"type":"emphasis","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"find the optimal controls ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"A2pANjosFx"},{"type":"inlineMath","value":"u_k","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">u_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"vW2aTnIStp"},{"type":"text","value":" at time instances ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"CH8oTcdxpe"},{"type":"inlineMath","value":"t_k","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>t</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">t_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7651em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">t</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"GwSPvDU4NE"},{"type":"text","value":"\nso that a total cost is minimized","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"hXmXG6q4Gu"}],"key":"kCghIjFteF"},{"type":"text","value":".  Note that we will later see the optimal controls can be represented in the form ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"Axhv4ve2hG"},{"type":"inlineMath","value":"u^*_k = K_kx_k","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mi>u</mi><mi>k</mi><mo>∗</mo></msubsup><mo>=</mo><msub><mi>K</mi><mi>k</mi></msub><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">u^*_k = K_kx_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9718em;vertical-align:-0.2831em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-2.4169em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2831em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"xcgve1OzYk"},{"type":"text","value":" for some optimal gain matrices ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"ACU7yXNaC6"},{"type":"inlineMath","value":"K_k","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">K_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"XT7foMacac"},{"type":"text","value":".  The LQR problem can be represented as a constrained optimization\nproblem where the costs of control and state error are represented by the\nminimization objective \\eqref{eq:cost}, and the system dynamics are represented by the\nconstraints \\eqref{eq:dyn_model}.","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"hfvJ9Ovnyx"}],"key":"tx53gduoJU"},{"type":"math","value":"\\def\\argmin{\\mathop{\\mathrm{argmin}}\\limits}\n\\def\\coloneqq{\\mathrel{\\mathop:}=}\n\n\\begin{equation} \\argmin\\limits_{u_{1\\sim N}} ~~x_N^T Q x_N + \\sum\\limits_{k=1}^{N-1} x_k^T Q x_k + u_k^T R u_k  \\end{equation}\n\\begin{equation} s.t. ~~ x_{k+1}=Ax_k+Bu_k ~~\\text{for } k=1 \\text{ to } N-1  \\end{equation}","identifier":"eq:cost","label":"eq:cost","html_id":"eq-cost","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtable rowspacing=\"0.16em\" columnspacing=\"1em\"><mtr><mtd class =\"mtr-glue\"></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><munder><mo><mrow><mi mathvariant=\"normal\">a</mi><mi mathvariant=\"normal\">r</mi><mi mathvariant=\"normal\">g</mi><mi mathvariant=\"normal\">m</mi><mi mathvariant=\"normal\">i</mi><mi mathvariant=\"normal\">n</mi></mrow></mo><msub><mi>u</mi><mrow><mn>1</mn><mo>∼</mo><mi>N</mi></mrow></msub></munder><mtext>  </mtext><msubsup><mi>x</mi><mi>N</mi><mi>T</mi></msubsup><mi>Q</mi><msub><mi>x</mi><mi>N</mi></msub><mo>+</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><msubsup><mi>x</mi><mi>k</mi><mi>T</mi></msubsup><mi>Q</mi><msub><mi>x</mi><mi>k</mi></msub><mo>+</mo><msubsup><mi>u</mi><mi>k</mi><mi>T</mi></msubsup><mi>R</mi><msub><mi>u</mi><mi>k</mi></msub></mrow></mstyle></mtd><mtd class =\"mtr-glue\"></mtd><mtd class =\"mml-eqn-num\"></mtd></mtr></mtable><mtable rowspacing=\"0.16em\" columnspacing=\"1em\"><mtr><mtd class =\"mtr-glue\"></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mi>s</mi><mi mathvariant=\"normal\">.</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mtext>  </mtext><msub><mi>x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><mi>A</mi><msub><mi>x</mi><mi>k</mi></msub><mo>+</mo><mi>B</mi><msub><mi>u</mi><mi>k</mi></msub><mtext>  for </mtext><mi>k</mi><mo>=</mo><mn>1</mn><mtext> to </mtext><mi>N</mi><mo>−</mo><mn>1</mn></mrow></mstyle></mtd><mtd class =\"mtr-glue\"></mtd><mtd class =\"mml-eqn-num\"></mtd></mtr></mtable></mrow><annotation encoding=\"application/x-tex\">\\def\\argmin{\\mathop{\\mathrm{argmin}}\\limits}\n\\def\\coloneqq{\\mathrel{\\mathop:}=}\n\n\\begin{equation} \\argmin\\limits_{u_{1\\sim N}} ~~x_N^T Q x_N + \\sum\\limits_{k=1}^{N-1} x_k^T Q x_k + u_k^T R u_k  \\end{equation}\n\\begin{equation} s.t. ~~ x_{k+1}=Ax_k+Bu_k ~~\\text{for } k=1 \\text{ to } N-1  \\end{equation}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:3.1304em;vertical-align:-1.3152em;\"></span><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8152em;\"><span style=\"top:-3.8152em;\"><span class=\"pstrut\" style=\"height:3.8283em;\"></span><span class=\"mord\"><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-2.2056em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3448em;\"><span style=\"top:-2.3567em;margin-left:0em;margin-right:0.0714em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size3 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">1</span><span class=\"mrel mtight\">∼</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1433em;\"><span></span></span></span></span></span></span></span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\"><span class=\"mord\"><span class=\"mord mathrm\">argmin</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9947em;\"><span></span></span></span></span></span><span class=\"mspace nobreak\"> </span><span class=\"mspace nobreak\"> </span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">Q</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8283em;\"><span style=\"top:-1.8479em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.05em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span><span class=\"mop op-symbol large-op\">∑</span></span></span><span style=\"top:-4.3em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3.05em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3021em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">Q</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.453em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3152em;\"><span></span></span></span></span></span></span><span class=\"tag\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.8152em;\"><span style=\"top:-3.8152em;\"><span class=\"pstrut\" style=\"height:3.8283em;\"></span><span class=\"eqn-num\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.3152em;\"><span></span></span></span></span></span><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.85em;\"><span style=\"top:-3.01em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">.</span><span class=\"mspace nobreak\"> </span><span class=\"mspace nobreak\"> </span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">A</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace nobreak\"> </span><span class=\"mspace nobreak\"> </span><span class=\"mord text\"><span class=\"mord\">for </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">1</span><span class=\"mord text\"><span class=\"mord\"> to </span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.35em;\"><span></span></span></span></span></span></span><span class=\"tag\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.85em;\"><span style=\"top:-2.85em;\"><span class=\"pstrut\" style=\"height:2.84em;\"></span><span class=\"eqn-num\"></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.35em;\"><span></span></span></span></span></span></span></span></span></span>","enumerator":"1","key":"taZMTXCgtI"},{"type":"paragraph","position":{"start":{"line":73,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"We can visualize the objective function and constraints in the form of a factor\ngraph as shown in ","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"UDUW2otWyn"},{"type":"link","url":"#fg_scratch","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"Figure 1","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"C5ZkYL9YTi"}],"urlSource":"#fg_scratch","key":"QhnAzZGB6G"},{"type":"text","value":". This is a simple Markov chain, with the oldest\nstates and controls on the left, and the newest states and controls on the right. ","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"hEjmJgAMSI"},{"type":"strong","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"text","value":"The\nternary factors represent the dynamics model constraints and the unary\nfactors represent the state and control costs we seek to minimize via least-squares.","position":{"start":{"line":73,"column":1},"end":{"line":73,"column":1}},"key":"mCTR1E6wHc"}],"key":"KbFWgYc7v9"}],"key":"X1YDwZ8Txl"},{"type":"heading","depth":2,"position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"children":[{"type":"text","value":"Variable Elimination","position":{"start":{"line":79,"column":1},"end":{"line":79,"column":1}},"key":"nFMim02e9O"}],"identifier":"variable-elimination","label":"Variable Elimination","html_id":"variable-elimination","implicit":true,"key":"biliAQ2myc"},{"type":"paragraph","position":{"start":{"line":80,"column":1},"end":{"line":82,"column":1}},"children":[{"type":"text","value":"To optimize the factor graph, which represents minimizing the least squares objectives above, we can simply eliminate the factors from right\nto left.  In this section we demonstrate the variable elimination graphically and algebraically, but the matrix elimination is also\nprovided in the ","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"RU2DZmqAZq"},{"type":"crossReference","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"Appendix","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"ZkWmVccoTm"}],"identifier":"least-squares-implementation-in-gtsam","label":"least-squares-implementation-in-gtsam","kind":"heading","template":"{name}","resolved":true,"html_id":"least-squares-implementation-in-gtsam","key":"Urz9LNEVrS"},{"type":"text","value":".","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"nJAAt9BcIi"}],"key":"IeS6S4jS6A"},{"type":"comment","value":" ********************** BEGIN VARIABLE ELIMINATION SLIDESHOW ********************** ","key":"AHjrUthalL"},{"type":"comment","value":" Slideshow container, based on https://www.w3schools.com/howto/howto_js_slideshow.asp ","key":"o3nXxJbo2U"},{"type":"raw","lang":"html","value":"<div class=\"slideshow-container\">\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <!-- <div class=\"numbertext\">2 / 3</div> -->\n    <a name=\"fig_eliminate_x_a\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide1.png\"\n        alt=\"Elimination of state $x_2$\" />\n        <figcaption><b>Figure 2a</b> Elimination of state $x_2$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <!-- <div class=\"numbertext\">2 / 3</div> -->\n    <a name=\"fig_eliminate_x_b\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide2.png\"\n        alt=\"Elimination of state $x_2$\" />\n        <figcaption><b>Figure 2b</b> Elimination of state $x_2$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_eliminate_u_a\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide3.png\"\n        alt=\"Elimination of state $u_1$\" />\n        <figcaption><b>Figure 3a</b> Elimination of state $u_1$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_eliminate_u_b\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide4.png\"\n        alt=\"Elimination of state $u_1$\" />\n        <figcaption><b>Figure 3b</b> Elimination of state $u_1$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_merge_factor\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide5.png\"\n        alt=\"Elimination of state $u_1$\" />\n        <figcaption><b>Figure 3c</b> Cost-to-go at $x_1$ is the sum of the two unary factors on $x_1$ (green)</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide6.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4a</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div>\n  <!-- <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide7.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4b</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div> -->\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide8.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4b</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide10.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4c</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide11.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4d</b> Completed Bayes net</figcaption>\n    </figure>\n  </div>\n  <!-- Next and previous buttons -->\n  <a class=\"prev\" onclick=\"plusSlides(-1,0)\">&#10094;</a>\n  <a class=\"next\" onclick=\"plusSlides(1,0)\">&#10095;</a>\n\n</div> <!-- slideshow-container -->\n\n<!-- The dots/circles -->\n<div style=\"text-align:center\">\n  <span class=\"dot 0\" onclick=\"currentSlide(1,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(2,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(3,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(4,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(5,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(6,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(7,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(8,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(9,0)\"></span>\n  <!-- <span class=\"dot 0\" onclick=\"currentSlide(10,0)\"></span> -->\n</div>\n\n<!-- this css is to make the scroll bar disappear when the mouse isn't over the scrollable div...\nTaken from my website: https://github.com/gchenfc/gerrysworld2/blob/master/css/activity.css -->\n<style>\n.scrollablecontent::-webkit-scrollbar {\n    width: 5px;\n    height: 12px;\n}\n.scrollablecontent::-webkit-scrollbar-track {\n    background: transparent;\n}\n.scrollablecontent::-webkit-scrollbar-thumb {\n    background: #ddd;\n    visibility:hidden;\n}\n.scrollablecontent:hover::-webkit-scrollbar-thumb {\n    visibility:visible;\n}\n/* .slideout {\n  width: 400px;\n  height: auto;\n  overflow: hidden;\n  background: orange;\n  margin: 0 auto;\n  transition: height 0.4s linear;\n}\n.hide {\n    height: 0;\n} */\n</style>\n<!-- ********************** END VARIABLE ELIMINATION SLIDESHOW ********************** -->\n\n<!-- ************************ BEGIN SCROLLABLE ELIMINATION DESCRIPTION ************************ -->\n<div class=\"scrollablecontent\" markdown=\"1\" id=\"sec:elim_scrollable\"\n    style=\"overflow-x: hidden; background-color:rgba(0,0,0,0.05); padding:0 8px; margin-bottom: 10px;\">\n<!-- ************** STATE ************** -->\n<div markdown=\"1\" id=\"sec:elim_state_div\" class=\"slideout\">\n<a id=\"sec:elim_state\"></a>\n### Eliminate a State\nLet us start at the last state, $x_2$. Gathering the two factors (marked in\nred [Figure 2a](#fig_eliminate_x_a){:onclick=\"currentSlide(1,0)\"}), we have \\eqref{eq:potential} the objective function $\\phi_1$, and \\eqref{eq:constrain} the constraint equation on $x_2$, $u_1$ and $x_1$:\n\n\\begin{equation} \\phi_1(x_2) = x_2^T Q x_2 \\label{eq:potential} \\end{equation}\n\n\\begin{equation} x_2 = Ax_1 + Bu_1 \\label{eq:constrain} \\end{equation}\n\nBy substituting $x_2$ from the dynamics constraint \\eqref{eq:constrain} into the objective function\n\\eqref{eq:potential}, we create a new factor representing\nthe cost of state $x_2$ as a function of $x_1$ and $u_1$:\n\n\\begin{equation} \\phi_2(x_1, u_1) = (Ax_1 + Bu_1)^T Q (Ax_1 + Bu_1)\n\\label{eq:potential_simplified} \\end{equation}\n\nThe resulting factor graph is illustrated in [Figure 2b](#fig_eliminate_x_b){:onclick=\"currentSlide(2,0)\"}.  Note that the \ndynamics constraint is now represented by the bayes net factors shown as gray arrows.\n\nTo summarize, we used the dynamics constraint to eliminate variable\n$x_2$ and the two factors marked in red, and we replaced them with a new binary cost factor on $x_1$\nand $u_1$, marked in blue. \n<p align=\"right\" style=\"background-color: rgba(0,0,0,0.1);\n    margin: 0px -8px 0 -8px;\n    padding: 0 8px;\"><a onclick=\"currentSlide(3,0)\">next >></a>\n</p>\n\n</div>\n<!-- ************** CONTROL ************** -->\n<div markdown=\"1\" id=\"sec:elim_ctrl_div\" class=\"slideout\">\n<a id=\"sec:elim_ctrl\"></a>\n### Eliminate a Control\n<!-- Now \\eqref{eq:potential_simplified} defines an (unnormalized) joint\nGaussian density on variables $x_1$ and $u_1$.  -->\nTo eliminate $u_1$, we seek to replace the two factors marked red in [Figure 3a](#fig_eliminate_u_a){:onclick=\"currentSlide(3,0)\"}\nwith a new cost factor on $x_1$ and an equation for the optimal control $$u_1^*(x_1)$$.\n\nAdding the control cost to \\eqref{eq:potential_simplified}, the combined cost of the\ntwo red factors in [Figure 3a](#fig_eliminate_u_a){:onclick=\"currentSlide(3,0)\"} is given by:\n\n\\begin{equation} \\phi_3(x_1, u_1) = u_1^TRu_1 + (Ax_1 + Bu_1)^T Q (Ax_1 + Bu_1)\n\\label{eq:potential_u1} \\end{equation}\n\n$\\phi_3$ is sometimes referred to as the *optimal action value function* and we seek to minimize it over $u_1$.\nWe do so by\nsetting the derivative of \\eqref{eq:potential_u1} wrt $u_1$ to zero\n<!-- (detailed calculation in the [Appendix](#eliminate-u_1)),  -->\nyielding the expression for the optimal control input $u_1^*$ as \n\n\\\\[ \\begin{align} \nu_1^*(x_1) &= \\argmin\\limits_{u_1}\\phi_3(x_1, u_1) \\nonumber \\\\\\\\ \n&= -(R+B^TQB)^{-1}B^TQAx_1 \\label{eq:control_law} \\\\\\\\ \n&= K_1x_1 \\nonumber\n\\end{align} \\\\]\n\nwhere $K_1\\coloneqq -(R+B^TQB)^{-1}B^TQA$.\n\nFinally, we substitute the expression of our optimal control, $$u_1^* = K_1x_1$$,\ninto our potential \\eqref{eq:potential_u1}\n<!-- (detailed calculation in the [Appendix](#marginalization-cost-on-x_1)) -->\nto obtain a new unary cost factor on $x_1$:\n\n\\begin{align}\n    \\phi_4(x_1) &= \\phi_3(x_1, u_1^*(x_1)) \\nonumber \\\\\\\\ \n        &= (K_1x_1)^T RK_1x_1 + (Ax_1 + BKx_1)^T Q (Ax_1 + BKx_1) \\nonumber \\\\\\\\ \n        &= x_1^T(A^TQA-K_1^TB^TQA)x_1 \\label{eq:potential_x1}\n\\end{align}\nNote that we simplified $K_1^TRK_1 + K_1^TB^TQBK_1 = -K_1^TB^TQA$ by substituting in for $K_1$ using\n\\eqref{eq:control_law}.\n\nThe resulting factor graph is illustrated in [Figure 3b](#fig_eliminate_u_b){:onclick=\"currentSlide(4,0)\"}.\n\nFor convenience, we will also define $P_k$ where $x_k^TP_kx_k$ represents the aggregate of the two unary costs on $x_k$.  In the case of $P_1$,\n\\begin{align}\n    x_1^TP_1x_1 &= x_1^TQx_1 + \\phi_4(x_1) \\nonumber\n\\end{align}\nis the aggregation of the two unary factors labeled in green in [Figure 3c](#fig_merge_factor){:onclick=\"currentSlide(5,0)\"}. \n<p style=\"background-color: rgba(0,0,0,0.1);\n    margin: 0px -8px 0 -8px;\n    padding: 0 8px;\">\n<span align=\"left\"><a onclick=\"currentSlide(2,0)\"><< prev</a><span style=\"float:right\"><a onclick=\"currentSlide(6,0)\">next >></a></span></span>\n</p>\n</div>\n<!-- ************** BAYES NET ************** -->\n<div markdown=\"1\" id=\"sec:elim_bayes_div\" class=\"slideout\">\n<a id=\"sec:elim_bayes\"></a>\n### Turning into a Bayes Network\nBy eliminating all the variables from right to left, we can get a Bayes network\nas shown in [Figure 4d](#fig_bayes_net){:onclick=\"currentSlide(9,0)\"}. Each time we eliminate a state\nand control, we simply repeat the steps in [Eliminate a state](#eliminate-a-state) and [Eliminate a control](#eliminate-a-control): we express the state $x_{k+1}$ with the dynamics model, then find the optimal control $u_k$ as\na function of state $x_k$.\n\nEliminating a general state, $x_{k+1}$, and control $u_k$, we obtain the recurrence relations:\n\n\\begin{equation} \\boxed{K_k = -(R+B^TP_{k+1}B)^{-1}B^TP_{k+1}A} \\label{eq:control_update_k} \\end{equation}\n\n\\begin{equation} \\boxed{P_k = Q+A^TP_{k+1}A - K_k^TB^TP_{k+1}A} \\label{eq:cost_update_k} \\end{equation}\n\nwith $P_{N}=Q$ is the cost at the last time step.\n\nThe final Bayes net in [Figure 4d](#fig_bayes_net){:onclick=\"currentSlide(9,0)\"} shows graphically the optimal control law:\n\\begin{equation} \\boxed{u^*_k = K_k x_k} \\end{equation}\n<p style=\"background-color: rgba(0,0,0,0.1);\n    margin: 0px -8px 0 -8px;\n    padding: 0 8px;\">\n<span align=\"left\"><a onclick=\"currentSlide(5,0)\"><< prev</a></span>\n</p>\n</div>\n</div> <!-- scrollablecontent -->\n<!-- ************************ END SCROLLABLE ELIMINATION DESCRIPTION ************************ -->","children":[{"type":"paragraph","children":[{"type":"text","value":"<div class=\"slideshow-container\">\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <!-- <div class=\"numbertext\">2 / 3</div> -->\n    <a name=\"fig_eliminate_x_a\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide1.png\"\n        alt=\"Elimination of state $x_2$\" />\n        <figcaption><b>Figure 2a</b> Elimination of state $x_2$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <!-- <div class=\"numbertext\">2 / 3</div> -->\n    <a name=\"fig_eliminate_x_b\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide2.png\"\n        alt=\"Elimination of state $x_2$\" />\n        <figcaption><b>Figure 2b</b> Elimination of state $x_2$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_eliminate_u_a\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide3.png\"\n        alt=\"Elimination of state $u_1$\" />\n        <figcaption><b>Figure 3a</b> Elimination of state $u_1$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_eliminate_u_b\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide4.png\"\n        alt=\"Elimination of state $u_1$\" />\n        <figcaption><b>Figure 3b</b> Elimination of state $u_1$</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_merge_factor\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide5.png\"\n        alt=\"Elimination of state $u_1$\" />\n        <figcaption><b>Figure 3c</b> Cost-to-go at $x_1$ is the sum of the two unary factors on $x_1$ (green)</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide6.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4a</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div>\n  <!-- <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide7.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4b</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div> -->\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide8.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4b</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide10.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4c</b> Repeat elimination until the graph is reduced to a Bayes net</figcaption>\n    </figure>\n  </div>\n  <div class=\"mySlides 0\" style=\"text-align: center;\">\n    <a name=\"fig_bayes_net\"></a>\n    <figure class=\"center\">\n    <img src=\"/_static/lqr_control/Elimination/cropped_Slide11.png\"\n        alt=\"Bayes net\" />\n        <figcaption><b>Figure 4d</b> Completed Bayes net</figcaption>\n    </figure>\n  </div>\n  <!-- Next and previous buttons -->\n  <a class=\"prev\" onclick=\"plusSlides(-1,0)\">&#10094;</a>\n  <a class=\"next\" onclick=\"plusSlides(1,0)\">&#10095;</a>\n\n</div> <!-- slideshow-container -->\n\n<!-- The dots/circles -->\n<div style=\"text-align:center\">\n  <span class=\"dot 0\" onclick=\"currentSlide(1,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(2,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(3,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(4,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(5,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(6,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(7,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(8,0)\"></span>\n  <span class=\"dot 0\" onclick=\"currentSlide(9,0)\"></span>\n  <!-- <span class=\"dot 0\" onclick=\"currentSlide(10,0)\"></span> -->\n</div>\n\n<!-- this css is to make the scroll bar disappear when the mouse isn't over the scrollable div...\nTaken from my website: https://github.com/gchenfc/gerrysworld2/blob/master/css/activity.css -->\n<style>\n.scrollablecontent::-webkit-scrollbar {\n    width: 5px;\n    height: 12px;\n}\n.scrollablecontent::-webkit-scrollbar-track {\n    background: transparent;\n}\n.scrollablecontent::-webkit-scrollbar-thumb {\n    background: #ddd;\n    visibility:hidden;\n}\n.scrollablecontent:hover::-webkit-scrollbar-thumb {\n    visibility:visible;\n}\n/* .slideout {\n  width: 400px;\n  height: auto;\n  overflow: hidden;\n  background: orange;\n  margin: 0 auto;\n  transition: height 0.4s linear;\n}\n.hide {\n    height: 0;\n} */\n</style>\n<!-- ********************** END VARIABLE ELIMINATION SLIDESHOW ********************** -->\n\n<!-- ************************ BEGIN SCROLLABLE ELIMINATION DESCRIPTION ************************ -->\n<div class=\"scrollablecontent\" markdown=\"1\" id=\"sec:elim_scrollable\"\n    style=\"overflow-x: hidden; background-color:rgba(0,0,0,0.05); padding:0 8px; margin-bottom: 10px;\">\n<!-- ************** STATE ************** -->\n<div markdown=\"1\" id=\"sec:elim_state_div\" class=\"slideout\">\n<a id=\"sec:elim_state\"></a>\n### Eliminate a State\nLet us start at the last state, $x_2$. Gathering the two factors (marked in\nred [Figure 2a](#fig_eliminate_x_a){:onclick=\"currentSlide(1,0)\"}), we have \\eqref{eq:potential} the objective function $\\phi_1$, and \\eqref{eq:constrain} the constraint equation on $x_2$, $u_1$ and $x_1$:\n\n\\begin{equation} \\phi_1(x_2) = x_2^T Q x_2 \\label{eq:potential} \\end{equation}\n\n\\begin{equation} x_2 = Ax_1 + Bu_1 \\label{eq:constrain} \\end{equation}\n\nBy substituting $x_2$ from the dynamics constraint \\eqref{eq:constrain} into the objective function\n\\eqref{eq:potential}, we create a new factor representing\nthe cost of state $x_2$ as a function of $x_1$ and $u_1$:\n\n\\begin{equation} \\phi_2(x_1, u_1) = (Ax_1 + Bu_1)^T Q (Ax_1 + Bu_1)\n\\label{eq:potential_simplified} \\end{equation}\n\nThe resulting factor graph is illustrated in [Figure 2b](#fig_eliminate_x_b){:onclick=\"currentSlide(2,0)\"}.  Note that the \ndynamics constraint is now represented by the bayes net factors shown as gray arrows.\n\nTo summarize, we used the dynamics constraint to eliminate variable\n$x_2$ and the two factors marked in red, and we replaced them with a new binary cost factor on $x_1$\nand $u_1$, marked in blue. \n<p align=\"right\" style=\"background-color: rgba(0,0,0,0.1);\n    margin: 0px -8px 0 -8px;\n    padding: 0 8px;\"><a onclick=\"currentSlide(3,0)\">next >></a>\n</p>\n\n</div>\n<!-- ************** CONTROL ************** -->\n<div markdown=\"1\" id=\"sec:elim_ctrl_div\" class=\"slideout\">\n<a id=\"sec:elim_ctrl\"></a>\n### Eliminate a Control\n<!-- Now \\eqref{eq:potential_simplified} defines an (unnormalized) joint\nGaussian density on variables $x_1$ and $u_1$.  -->\nTo eliminate $u_1$, we seek to replace the two factors marked red in [Figure 3a](#fig_eliminate_u_a){:onclick=\"currentSlide(3,0)\"}\nwith a new cost factor on $x_1$ and an equation for the optimal control $$u_1^*(x_1)$$.\n\nAdding the control cost to \\eqref{eq:potential_simplified}, the combined cost of the\ntwo red factors in [Figure 3a](#fig_eliminate_u_a){:onclick=\"currentSlide(3,0)\"} is given by:\n\n\\begin{equation} \\phi_3(x_1, u_1) = u_1^TRu_1 + (Ax_1 + Bu_1)^T Q (Ax_1 + Bu_1)\n\\label{eq:potential_u1} \\end{equation}\n\n$\\phi_3$ is sometimes referred to as the *optimal action value function* and we seek to minimize it over $u_1$.\nWe do so by\nsetting the derivative of \\eqref{eq:potential_u1} wrt $u_1$ to zero\n<!-- (detailed calculation in the [Appendix](#eliminate-u_1)),  -->\nyielding the expression for the optimal control input $u_1^*$ as \n\n\\\\[ \\begin{align} \nu_1^*(x_1) &= \\argmin\\limits_{u_1}\\phi_3(x_1, u_1) \\nonumber \\\\\\\\ \n&= -(R+B^TQB)^{-1}B^TQAx_1 \\label{eq:control_law} \\\\\\\\ \n&= K_1x_1 \\nonumber\n\\end{align} \\\\]\n\nwhere $K_1\\coloneqq -(R+B^TQB)^{-1}B^TQA$.\n\nFinally, we substitute the expression of our optimal control, $$u_1^* = K_1x_1$$,\ninto our potential \\eqref{eq:potential_u1}\n<!-- (detailed calculation in the [Appendix](#marginalization-cost-on-x_1)) -->\nto obtain a new unary cost factor on $x_1$:\n\n\\begin{align}\n    \\phi_4(x_1) &= \\phi_3(x_1, u_1^*(x_1)) \\nonumber \\\\\\\\ \n        &= (K_1x_1)^T RK_1x_1 + (Ax_1 + BKx_1)^T Q (Ax_1 + BKx_1) \\nonumber \\\\\\\\ \n        &= x_1^T(A^TQA-K_1^TB^TQA)x_1 \\label{eq:potential_x1}\n\\end{align}\nNote that we simplified $K_1^TRK_1 + K_1^TB^TQBK_1 = -K_1^TB^TQA$ by substituting in for $K_1$ using\n\\eqref{eq:control_law}.\n\nThe resulting factor graph is illustrated in [Figure 3b](#fig_eliminate_u_b){:onclick=\"currentSlide(4,0)\"}.\n\nFor convenience, we will also define $P_k$ where $x_k^TP_kx_k$ represents the aggregate of the two unary costs on $x_k$.  In the case of $P_1$,\n\\begin{align}\n    x_1^TP_1x_1 &= x_1^TQx_1 + \\phi_4(x_1) \\nonumber\n\\end{align}\nis the aggregation of the two unary factors labeled in green in [Figure 3c](#fig_merge_factor){:onclick=\"currentSlide(5,0)\"}. \n<p style=\"background-color: rgba(0,0,0,0.1);\n    margin: 0px -8px 0 -8px;\n    padding: 0 8px;\">\n<span align=\"left\"><a onclick=\"currentSlide(2,0)\"><< prev</a><span style=\"float:right\"><a onclick=\"currentSlide(6,0)\">next >></a></span></span>\n</p>\n</div>\n<!-- ************** BAYES NET ************** -->\n<div markdown=\"1\" id=\"sec:elim_bayes_div\" class=\"slideout\">\n<a id=\"sec:elim_bayes\"></a>\n### Turning into a Bayes Network\nBy eliminating all the variables from right to left, we can get a Bayes network\nas shown in [Figure 4d](#fig_bayes_net){:onclick=\"currentSlide(9,0)\"}. Each time we eliminate a state\nand control, we simply repeat the steps in [Eliminate a state](#eliminate-a-state) and [Eliminate a control](#eliminate-a-control): we express the state $x_{k+1}$ with the dynamics model, then find the optimal control $u_k$ as\na function of state $x_k$.\n\nEliminating a general state, $x_{k+1}$, and control $u_k$, we obtain the recurrence relations:\n\n\\begin{equation} \\boxed{K_k = -(R+B^TP_{k+1}B)^{-1}B^TP_{k+1}A} \\label{eq:control_update_k} \\end{equation}\n\n\\begin{equation} \\boxed{P_k = Q+A^TP_{k+1}A - K_k^TB^TP_{k+1}A} \\label{eq:cost_update_k} \\end{equation}\n\nwith $P_{N}=Q$ is the cost at the last time step.\n\nThe final Bayes net in [Figure 4d](#fig_bayes_net){:onclick=\"currentSlide(9,0)\"} shows graphically the optimal control law:\n\\begin{equation} \\boxed{u^*_k = K_k x_k} \\end{equation}\n<p style=\"background-color: rgba(0,0,0,0.1);\n    margin: 0px -8px 0 -8px;\n    padding: 0 8px;\">\n<span align=\"left\"><a onclick=\"currentSlide(5,0)\"><< prev</a></span>\n</p>\n</div>\n</div> <!-- scrollablecontent -->\n<!-- ************************ END SCROLLABLE ELIMINATION DESCRIPTION ************************ -->","key":"A8waDnEPQa"}],"key":"TprZa7VhTK"}],"key":"Dv9yoiNvYc"},{"type":"heading","depth":2,"position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"children":[{"type":"text","value":"Intuition","position":{"start":{"line":338,"column":1},"end":{"line":338,"column":1}},"key":"xTP2KvIPe8"}],"identifier":"intuition","label":"Intuition","html_id":"intuition","implicit":true,"key":"i3ofwZTiWD"},{"type":"comment","value":" ************** Value Function ************** ","key":"UmbLoFpizA"},{"type":"paragraph","position":{"start":{"line":340,"column":1},"end":{"line":340,"column":1}},"children":[{"type":"link","url":"","children":[],"urlSource":"","key":"yA7ePGH3Ht"}],"key":"v96mdSf8O6"},{"type":"container","class":"center","style":{"width":"90%","padding":"10px"},"children":[{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 5","key":"patQ37alRl"}],"key":"umJVHykjIC"},{"type":"text","value":" Example LQR control solutions as solved by factor graphs (middle) and the traditional Discrete Algebraic Ricatti Equations (right). The optimal control gains and cost-to-go factors are compared (left). All plots show exact agreement between factor graph and Ricatti equation solutions.","key":"RjtZ8FZM1r"}],"key":"K8B4aHMWzG"}],"key":"TGtFgD5eHp"},{"type":"legend","children":[{"type":"link","url":"/_static/lqr_control/LQR_FGvsRicatti.png","children":[{"type":"image","style":{"marginBottom":"10px","maxWidth":"110%","marginLeft":"-5%"},"url":"/LQR_FGvsRicatti-6b4abe938eef70dce7ec57679a2768de.png","alt":"Comparison between LQR control as solved by factor graphs and by the Ricatti Equation. (they are the same)","key":"a4wcOCDPKM","urlSource":"/_static/lqr_control/LQR_FGvsRicatti.png"}],"urlSource":"/_static/lqr_control/LQR_FGvsRicatti.png","key":"AX6l76jOyS"}],"key":"M05HG6R03a"}],"enumerator":"2","key":"ejRkFZT8Kq"},{"type":"paragraph","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"We introduce the ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"gMXUFgZLRL"},{"type":"strong","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"cost-to-go","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"sF2307dajg"}],"key":"SyLkCdU7WS"},{"type":"text","value":" (also known as ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"mHhRLbOpPE"},{"type":"emphasis","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"return cost","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"Y1qw4J04Nl"}],"key":"YrHJgHNH7b"},{"type":"text","value":", ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"EEwKqW9sSZ"},{"type":"emphasis","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"optimal state value function","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"G1n9uiH5Ip"}],"key":"ntMdaXmubY"},{"type":"text","value":", or simply ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"l1nSAa4Phf"},{"type":"emphasis","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"value function","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"RxYEzflqNk"}],"key":"vnbXOL3mha"},{"type":"text","value":") as ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"geZffJLjWZ"},{"type":"inlineMath","value":"V_k(x) \\coloneqq x^TP_kx","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>V</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo><mi mathvariant=\"normal\">≔</mi></mo><msup><mi>x</mi><mi>T</mi></msup><msub><mi>P</mi><mi>k</mi></msub><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">V_k(x) \\coloneqq x^TP_kx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mop\" style=\"position:relative;top:-0.0347em;\">:</span></span><span class=\"mrel\"><span class=\"mspace\" style=\"margin-right:-0.0667em;\"></span></span><span class=\"mrel\">=</span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9913em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8413em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"FZZNjGKcCx"},{"type":"text","value":" which intuitively represents ","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"Jre7MQMS9A"},{"type":"emphasis","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"children":[{"type":"text","value":"the total cost that will be accrued from here on out, assuming optimal control","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"ZxemRBxv9Y"}],"key":"P7E2FXn73z"},{"type":"text","value":".","position":{"start":{"line":348,"column":1},"end":{"line":348,"column":1}},"key":"hGa2Glvnyu"}],"key":"SpywWYYiIS"},{"type":"paragraph","position":{"start":{"line":350,"column":1},"end":{"line":351,"column":1}},"children":[{"type":"text","value":"In our factor graph representation, it is becomes obvious that ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"rZXRKjviGP"},{"type":"inlineMath","value":"V_k(x)","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>V</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">V_k(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>","key":"aaBhx71doo"},{"type":"text","value":" corresponds to the total cost at and after the state ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"Pk9Qc5rBYo"},{"type":"inlineMath","value":"x_k","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">x_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"mwBwmkY2F5"},{"type":"text","value":" assuming optimal control because we eliminate variables backwards in time with the objective of minimizing cost.\nEliminating a state just re-expresses the future cost in terms of prior states/controls.  Each time we eliminate a control, ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"nnG4gqFHW4"},{"type":"inlineMath","value":"u","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>u</mi></mrow><annotation encoding=\"application/x-tex\">u</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">u</span></span></span></span>","key":"mjF5fviYmA"},{"type":"text","value":", the future cost is recalculated assuming optimal control (i.e. ","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"mJkkYEuUD8"},{"type":"inlineMath","value":"\\phi_4(x) = \\phi_3(x, u^*)","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>ϕ</mi><mn>4</mn></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><msub><mi>ϕ</mi><mn>3</mn></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><msup><mi>u</mi><mo>∗</mo></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\phi_4(x) = \\phi_3(x, u^*)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϕ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">ϕ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6887em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mbin mtight\">∗</span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"wbvNZn7r3V"},{"type":"text","value":").","position":{"start":{"line":350,"column":1},"end":{"line":350,"column":1}},"key":"refq4q7WVE"}],"key":"GlnxNukpWJ"},{"type":"paragraph","position":{"start":{"line":353,"column":1},"end":{"line":355,"column":1}},"children":[{"type":"text","value":"This “cost-to-go” is depicted as a heatmap in ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"Nu03anBJXm"},{"type":"link","url":"#LQR_example","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"children":[{"type":"text","value":"Figure 5","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"GZ8Tv1UMEw"}],"urlSource":"#LQR_example","key":"WYk1iOVH6w"},{"type":"text","value":".\nThe heat maps depict the ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"QaB5t8HIPb"},{"type":"inlineMath","value":"V_k","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>V</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">V_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"PvJj0BJQ4H"},{"type":"text","value":" showing that the cost is high when ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"RtoO447uct"},{"type":"inlineMath","value":"x","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span>","key":"cl1n08sZC4"},{"type":"text","value":" is far from 0, but also showing that after iterating sufficient far backwards in time, ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"UVZcwINOSy"},{"type":"inlineMath","value":"V_k(x)","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>V</mi><mi>k</mi></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">V_k(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>","key":"zlAXeunyCo"},{"type":"text","value":" begins to converge.  That is to say, the ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"d8D3bGFuM2"},{"type":"inlineMath","value":"V_0(x)","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>V</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">V_0(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>","key":"MNSqin79wo"},{"type":"text","value":" is very similar for ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"kWtGa5gSQ8"},{"type":"inlineMath","value":"N=30","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>=</mo><mn>30</mn></mrow><annotation encoding=\"application/x-tex\">N=30</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">30</span></span></span></span>","key":"MNDStpj9w0"},{"type":"text","value":" and ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"BYs75MIBOg"},{"type":"inlineMath","value":"N=100","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding=\"application/x-tex\">N=100</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">100</span></span></span></span>","key":"ZUpwMflXGo"},{"type":"text","value":".\nSimilarly, the leftmost plot of ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"rsPnceRZl1"},{"type":"link","url":"#LQR_example","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"children":[{"type":"text","value":"Figure 5","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"dEsaGf9n37"}],"urlSource":"#LQR_example","key":"XVqL9wrH58"},{"type":"text","value":" depicts ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"mZpPlyfxYc"},{"type":"inlineMath","value":"K_k","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">K_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"Wp6OXAeUGK"},{"type":"text","value":" and ","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"l7DvQlFnwF"},{"type":"inlineMath","value":"P_k","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"K7q9KtxkTF"},{"type":"text","value":" and shows that they (predictably) converge as well.","position":{"start":{"line":353,"column":1},"end":{"line":353,"column":1}},"key":"GGELhv1ysr"}],"key":"kdwfW9dBEy"},{"type":"paragraph","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"children":[{"type":"text","value":"This convergence allows us to see that we can extend to the ","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"k62Uu9INfQ"},{"type":"link","url":"https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator#Infinite-horizon,_discrete-time_LQR","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"children":[{"type":"text","value":"infinite horizon LQR problem","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"yrnjuzhsWI"}],"urlSource":"https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator#Infinite-horizon,_discrete-time_LQR","data":{"page":"Linear%E2%80%93quadratic_regulator#Infinite-horizon,_discrete-time_LQR","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"labnkJ7H1z"},{"type":"text","value":" (continued in the next section).","position":{"start":{"line":357,"column":1},"end":{"line":357,"column":1}},"key":"Bf7pBtYbM2"}],"key":"OdwywgCpDP"},{"type":"comment","value":" The factor graph representation also gives us insight to the equation for the optimal gain matrix $K_k$ from\n\\eqref{eq:control_update_k}.\nThe optimal control, $K_k$, should attempt to balance (a) the unary factor $u_k^TRu_k$ representing the cost of executing a control action and (b) the binary factor $(Ax_k+Bu_k)^TP_{k+1}(Ax_k+Bu_k)$ representing the future cost of the control action.\n\nThe binary factor consists of two terms\nrepresents a balance between achieving a small \"cost-to-go\" next time step ($B^TP_{k+1}B$) and exerting a small\namount of control this time step ($R$). ","key":"pmx9e8MEMf"},{"type":"heading","depth":2,"position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"children":[{"type":"text","value":"Equivalence to the Ricatti Equation","position":{"start":{"line":367,"column":1},"end":{"line":367,"column":1}},"key":"qK37D3IEF4"}],"identifier":"equivalence-to-the-ricatti-equation","label":"Equivalence to the Ricatti Equation","html_id":"equivalence-to-the-ricatti-equation","implicit":true,"key":"zoCYcnHQBX"},{"type":"paragraph","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"In traditional descriptions of discrete, finite-horizon LQR (i.e. ","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"X7djxoStRZ"},{"type":"link","url":"https://www.amazon.com/Analysis-Control-Dynamic-Economic-Systems/dp/0898749697","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"Chow","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"liPDtWT7mH"}],"urlSource":"https://www.amazon.com/Analysis-Control-Dynamic-Economic-Systems/dp/0898749697","key":"BOelYOgPpI"},{"type":"text","value":", ","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"k93aA9xW81"},{"type":"link","url":"https://pdfs.semanticscholar.org/9777/06d1dc022280f47a2c67c646e85f38d88fe2.pdf#page=86","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"Kirk","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"A8ItBValAs"}],"urlSource":"https://pdfs.semanticscholar.org/9777/06d1dc022280f47a2c67c646e85f38d88fe2.pdf#page=86","key":"GO1CG2eOFK"},{"type":"text","value":", ","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"O8N7wxBEHa"},{"type":"link","url":"https://stanford.edu/class/ee363/lectures/dlqr.pdf","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"children":[{"type":"text","value":"Stanford","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"cYnykwdVJg"}],"urlSource":"https://stanford.edu/class/ee363/lectures/dlqr.pdf","key":"VgcMnxEmuB"},{"type":"text","value":"), the control law and cost function are given by","position":{"start":{"line":369,"column":1},"end":{"line":369,"column":1}},"key":"Fv9CtgVK5d"}],"key":"mdW6BSDkh6"},{"type":"paragraph","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"children":[{"type":"text","value":"\\[ u_k = K_kx_k \\]","position":{"start":{"line":371,"column":1},"end":{"line":371,"column":1}},"key":"hMWcM5hQ60"}],"key":"kAvOqJpfqt"},{"type":"math","value":"K_k = -(R+B^TP_{k+1}B)^{-1}B^TP_{k+1}A","enumerated":true,"position":{"start":{"line":373,"column":1},"end":{"line":372,"column":1}},"identifier":"eq:control_update_k_ricatti","label":"eq:control_update_k_ricatti","html_id":"eq-control-update-k-ricatti","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>K</mi><mi>k</mi></msub><mo>=</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mi>R</mi><mo>+</mo><msup><mi>B</mi><mi>T</mi></msup><msub><mi>P</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mi>B</mi><msup><mo stretchy=\"false\">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>B</mi><mi>T</mi></msup><msub><mi>P</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">K_k = -(R+B^TP_{k+1}B)^{-1}B^TP_{k+1}A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">−</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1413em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">A</span></span></span></span></span>","enumerator":"2","key":"TAv8RkvdF3"},{"type":"math","value":"P_k = Q+A^TP_{k+1}A - K_k^TB^TP_{k+1}A","enumerated":true,"position":{"start":{"line":375,"column":1},"end":{"line":374,"column":1}},"identifier":"eq:cost_update_k_ricatti","label":"eq:cost_update_k_ricatti","html_id":"eq-cost-update-k-ricatti","html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub><mo>=</mo><mi>Q</mi><mo>+</mo><msup><mi>A</mi><mi>T</mi></msup><msub><mi>P</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mi>A</mi><mo>−</mo><msubsup><mi>K</mi><mi>k</mi><mi>T</mi></msubsup><msup><mi>B</mi><mi>T</mi></msup><msub><mi>P</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mi>A</mi></mrow><annotation encoding=\"application/x-tex\">P_k = Q+A^TP_{k+1}A - K_k^TB^TP_{k+1}A</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0997em;vertical-align:-0.2083em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.1383em;vertical-align:-0.247em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-2.453em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.247em;\"><span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">+</span><span class=\"mord mtight\">1</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2083em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">A</span></span></span></span></span>","enumerator":"3","key":"BYtHOacuaB"},{"type":"paragraph","position":{"start":{"line":377,"column":1},"end":{"line":381,"column":1}},"children":[{"type":"text","value":"with ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"DoO9FYq3wQ"},{"type":"inlineMath","value":"P_k","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>k</mi></msub></mrow><annotation encoding=\"application/x-tex\">P_k</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"SjzM6fDDsD"},{"type":"text","value":" commonly referred to as the solution to the ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"HgMeTm7Jmf"},{"type":"strong","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"children":[{"type":"text","value":"dynamic Ricatti equation","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"mwY9f1ubEj"}],"key":"SVnynjEv2O"},{"type":"text","value":" and ","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"HsxYuYQGMm"},{"type":"inlineMath","value":"P_N=Q","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mi>N</mi></msub><mo>=</mo><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">P_N=Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>","key":"vLO0a7O2oN"},{"type":"text","value":" is the\nvalue of the Ricatti function at the final time step.\n\\eqref{eq:control_update_k_ricatti} and \\eqref{eq:cost_update_k_ricatti} correspond to\nthe same results as we derived in \\eqref{eq:control_update_k} and \\eqref{eq:cost_update_k}\nrespectively.","position":{"start":{"line":377,"column":1},"end":{"line":377,"column":1}},"key":"SlZomWpVZ5"}],"key":"HBbpGBepRs"},{"type":"paragraph","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"children":[{"type":"text","value":"Recall that ","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"TNmeI4ZH3O"},{"type":"inlineMath","value":"P_0","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>P</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">P_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"d10RY0GrnE"},{"type":"text","value":" and ","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"OUCiopFRo3"},{"type":"inlineMath","value":"K_0","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>K</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">K_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"lEVsQtJgpY"},{"type":"text","value":" appear to converge as the number of time steps grows.  They will approach a stationary solution to the equations","position":{"start":{"line":383,"column":1},"end":{"line":383,"column":1}},"key":"cw6P4i5Dk4"}],"key":"b9QgKZXmWK"},{"type":"math","value":"\\begin{align}\nK &= -(R+B^TPB)^{-1}B^TPA \\nonumber \\\\\\\\ \nP &= Q+A^TPA - K^TB^TPA \\nonumber\n\\end{align}","position":{"start":{"line":385,"column":1},"end":{"line":387,"column":1}},"html":"<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mtable rowspacing=\"0.25em\" columnalign=\"right left\" columnspacing=\"0em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>K</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mo>−</mo><mo stretchy=\"false\">(</mo><mi>R</mi><mo>+</mo><msup><mi>B</mi><mi>T</mi></msup><mi>P</mi><mi>B</mi><msup><mo stretchy=\"false\">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>B</mi><mi>T</mi></msup><mi>P</mi><mi>A</mi></mrow></mstyle></mtd></mtr><mtr><mtd class =\"mtr-glue\"></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow></mrow></mstyle></mtd><mtd class =\"mtr-glue\"></mtd><mtd class =\"mml-eqn-num\"></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mi>P</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"true\"><mrow><mrow></mrow><mo>=</mo><mi>Q</mi><mo>+</mo><msup><mi>A</mi><mi>T</mi></msup><mi>P</mi><mi>A</mi><mo>−</mo><msup><mi>K</mi><mi>T</mi></msup><msup><mi>B</mi><mi>T</mi></msup><mi>P</mi><mi>A</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding=\"application/x-tex\">\\begin{align}\nK &amp;= -(R+B^TPB)^{-1}B^TPA \\nonumber \\\\\\\\ \nP &amp;= Q+A^TPA - K^TB^TPA \\nonumber\n\\end{align}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:4.6027em;vertical-align:-2.0513em;\"></span><span class=\"mtable\"><span class=\"col-align-r\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5513em;\"><span style=\"top:-4.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span><span style=\"top:-3.16em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"></span></span><span style=\"top:-1.6087em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0513em;\"><span></span></span></span></span></span><span class=\"col-align-l\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5513em;\"><span style=\"top:-4.66em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">−</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.00773em;\">R</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">PB</span><span class=\"mclose\"><span class=\"mclose\">)</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8641em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal\">A</span></span></span><span style=\"top:-1.6087em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\"></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord mathnormal\">Q</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">A</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal\">A</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05017em;\">B</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8913em;\"><span style=\"top:-3.113em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\">T</span></span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span><span class=\"mord mathnormal\">A</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0513em;\"><span></span></span></span></span></span></span></span><span class=\"tag\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.5513em;\"><span style=\"top:-4.5513em;\"><span class=\"pstrut\" style=\"height:2.8913em;\"></span><span></span></span><span style=\"top:-3.0513em;\"><span class=\"pstrut\" style=\"height:2.8913em;\"></span><span class=\"eqn-num\"></span></span><span style=\"top:-1.5em;\"><span class=\"pstrut\" style=\"height:2.8913em;\"></span><span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:2.0513em;\"><span></span></span></span></span></span></span></span></span>","enumerator":"4","key":"uaer6usUVb"},{"type":"paragraph","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"text","value":"as ","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"GM1PtqPYhg"},{"type":"inlineMath","value":"N\\to\\infty","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>N</mi><mo>→</mo><mi mathvariant=\"normal\">∞</mi></mrow><annotation encoding=\"application/x-tex\">N\\to\\infty</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">→</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord\">∞</span></span></span></span>","key":"GpQpllBqZ0"},{"type":"text","value":".  This is the ","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"ZfLBoxFbLW"},{"type":"link","url":"https://en.wikipedia.org/wiki/Algebraic_Riccati_equation","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"text","value":"Discrete Algebraic Ricatti Equations (DARE)","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"EBRYmPvCQx"}],"urlSource":"https://en.wikipedia.org/wiki/Algebraic_Riccati_equation","data":{"page":"Algebraic_Riccati_equation","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"fAKQcihEQV"},{"type":"text","value":" and ","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"FqJ65ok50J"},{"type":"inlineMath","value":"\\lim_{N\\to\\infty}V_0(x)","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>N</mi><mo>→</mo><mi mathvariant=\"normal\">∞</mi></mrow></msub><msub><mi>V</mi><mn>0</mn></msub><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\lim_{N\\to\\infty}V_0(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">∞</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>","key":"fgKFGmn6wm"},{"type":"text","value":" and ","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"HGPpyPgdRB"},{"type":"inlineMath","value":"\\lim_{N\\to\\infty}K_0","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>N</mi><mo>→</mo><mi mathvariant=\"normal\">∞</mi></mrow></msub><msub><mi>K</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\lim_{N\\to\\infty}K_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10903em;\">N</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">∞</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"PqV1Hm95ej"},{"type":"text","value":" are the cost-to-go and optimal control gain respectively for the ","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"Bb0thx2WRt"},{"type":"link","url":"https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator#Infinite-horizon,_discrete-time_LQR","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"children":[{"type":"text","value":"infinite horizon LQR problem","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"p7mvlemTKZ"}],"urlSource":"https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator#Infinite-horizon,_discrete-time_LQR","data":{"page":"Linear%E2%80%93quadratic_regulator#Infinite-horizon,_discrete-time_LQR","wiki":"https://en.wikipedia.org/","lang":"en"},"internal":false,"protocol":"wiki","key":"MShDGymNrR"},{"type":"text","value":".  Indeed, one way to calculate the solution to the DARE is to iterate on the dynamic Ricatti equation.","position":{"start":{"line":390,"column":1},"end":{"line":390,"column":1}},"key":"dhKP38Vozy"}],"key":"L1Jmid8RKV"},{"type":"heading","depth":2,"position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"children":[{"type":"text","value":"Implementation using GTSAM","position":{"start":{"line":392,"column":1},"end":{"line":392,"column":1}},"key":"rOzUZ2mvMD"}],"identifier":"implementation-using-gtsam","label":"Implementation using GTSAM","html_id":"implementation-using-gtsam","implicit":true,"key":"g2t3ZJ7Rty"},{"type":"paragraph","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"children":[{"type":"text","value":"**Edit (Apr 17, 2021): Code updated to new Python wrapper as of GTSAM 4.1.0.","position":{"start":{"line":393,"column":1},"end":{"line":393,"column":1}},"key":"ii9bJh8RcZ"}],"key":"oTHV1wBz12"},{"type":"paragraph","position":{"start":{"line":395,"column":1},"end":{"line":398,"column":1}},"children":[{"type":"text","value":"You can view an example Jupyter notebook on ","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"key":"mVTNqn16eo"},{"type":"link","url":"https://colab.research.google.com/drive/1pIUC6fQVMEaQ7QfJk8BvD0F60gShj3F4#sandboxMode=true","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"children":[{"type":"text","value":"google colab","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"key":"Ls1y8HDCND"}],"urlSource":"https://colab.research.google.com/drive/1pIUC6fQVMEaQ7QfJk8BvD0F60gShj3F4#sandboxMode=true","key":"aaGfKwzeXZ"},{"type":"text","value":"{:target=“_blank”} or\n","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"key":"NGavRXTzwC"},{"type":"link","url":"/assets/code_samples/lqr_control.zip","children":[{"type":"text","value":"download","key":"EDP9BrPvbu"}],"urlSource":"/assets/code_samples/lqr_control.zip","key":"ExTim6XmNN"},{"type":"text","value":" the modules/examples\nthat you can use in your\nprojects to:","position":{"start":{"line":395,"column":1},"end":{"line":395,"column":1}},"key":"tn1UaNzx3t"}],"key":"qEhJvoT7Ft"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":399,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"children":[{"type":"text","value":"Calculate the closed loop gain matrix, K, using GTSAM","position":{"start":{"line":399,"column":1},"end":{"line":399,"column":1}},"key":"SP35Ou2CjW"}],"key":"YMkZLmRwiS"},{"type":"listItem","spread":true,"position":{"start":{"line":400,"column":1},"end":{"line":401,"column":1}},"children":[{"type":"text","value":"Calculate the “cost-to-go” matrix, P (which is equivalent to the solutions to\nthe dynamic Ricatti equation), using GTSAM","position":{"start":{"line":400,"column":1},"end":{"line":400,"column":1}},"key":"XYOqNQHhxn"}],"key":"JA5EKlL4zn"},{"type":"listItem","spread":true,"position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"children":[{"type":"text","value":"Calculate the LQR solution for a non-zero, non-constant goal position, using GTSAM","position":{"start":{"line":402,"column":1},"end":{"line":402,"column":1}},"key":"Lzl3r0oqZT"}],"key":"qZ30u6r87G"},{"type":"listItem","spread":true,"position":{"start":{"line":403,"column":1},"end":{"line":404,"column":1}},"children":[{"type":"text","value":"Visualize the cost-to-go and how it relates to factor graphs and the Ricatti\nequation","position":{"start":{"line":403,"column":1},"end":{"line":403,"column":1}},"key":"ICjSfVDBll"}],"key":"GVREOx8FCd"},{"type":"listItem","spread":true,"position":{"start":{"line":405,"column":1},"end":{"line":406,"column":1}},"children":[{"type":"text","value":"and more!","position":{"start":{"line":405,"column":1},"end":{"line":405,"column":1}},"key":"DuPa0gLPM9"}],"key":"xVPynDuM2c"}],"key":"OxZDKk4xBv"},{"type":"paragraph","position":{"start":{"line":407,"column":1},"end":{"line":408,"column":1}},"children":[{"type":"text","value":"A brief example of the open-loop finite horizon LQR problem using\nfactor graphs is shown below:","position":{"start":{"line":407,"column":1},"end":{"line":407,"column":1}},"key":"R0oHBknUZS"}],"key":"YmaeAmvptJ"},{"type":"div","class":"scrollablecontent","style":{"overflow":"auto","height":"600px"},"children":[{"type":"code","lang":"python","meta":null,"value":"def solve_lqr(A, B, Q, R, X0=np.array([0., 0.]), num_time_steps=500):\n    '''Solves a discrete, finite horizon LQR problem given system dynamics in\n    state space representation.\n    Arguments:\n        A, B: nxn state transition matrix and nxp control input matrix\n        Q, R: nxn state cost matrix and pxp control cost matrix\n        X0: initial state (n-vector)\n        num_time_steps: number of time steps, T\n    Returns:\n        x_sol, u_sol: Txn array of states and Txp array of controls\n    '''\n    n = np.size(A, 0)\n    p = np.size(B, 1)\n\n    # noise models\n    prior_noise = gtsam.noiseModel.Constrained.All(n)\n    dynamics_noise = gtsam.noiseModel.Constrained.All(n)\n    q_noise = gtsam.noiseModel.Gaussian.Information(Q)\n    r_noise = gtsam.noiseModel.Gaussian.Information(R)\n\n    # Create an empty Gaussian factor graph\n    graph = gtsam.GaussianFactorGraph()\n\n    # Create the keys corresponding to unknown variables in the factor graph\n    X = []\n    U = []\n    for k in range(num_time_steps):\n        X.append(gtsam.symbol('x', k))\n        U.append(gtsam.symbol('u', k))\n\n    # set initial state as prior\n    graph.add(X[0], np.eye(n), X0, prior_noise)\n\n    # Add dynamics constraint as ternary factor\n    #   A.x1 + B.u1 - I.x2 = 0\n    for k in range(num_time_steps-1):\n        graph.add(X[k], A, U[k], B, X[k+1], -np.eye(n),\n                  np.zeros((n)), dynamics_noise)\n\n    # Add cost functions as unary factors\n    for x in X:\n        graph.add(x, np.eye(n), np.zeros(n), q_noise)\n    for u in U:\n        graph.add(u, np.eye(p), np.zeros(p), r_noise)\n\n    # Solve\n    result = graph.optimize()\n    x_sol = np.zeros((num_time_steps, n))\n    u_sol = np.zeros((num_time_steps, p))\n    for k in range(num_time_steps):\n        x_sol[k, :] = result.at(X[k])\n        u_sol[k] = result.at(U[k])\n    \n    return x_sol, u_sol","key":"FuFTrIAlyS"}],"key":"VPOKa14yzB"},{"type":"heading","depth":2,"position":{"start":{"line":470,"column":1},"end":{"line":470,"column":1}},"children":[{"type":"text","value":"Future Work","position":{"start":{"line":470,"column":1},"end":{"line":470,"column":1}},"key":"y1YQtYNfz1"}],"identifier":"future-work","label":"Future Work","html_id":"future-work","implicit":true,"key":"pqLcQoMb4G"},{"type":"paragraph","position":{"start":{"line":471,"column":1},"end":{"line":472,"column":1}},"children":[{"type":"text","value":"The factor graph ","position":{"start":{"line":471,"column":1},"end":{"line":471,"column":1}},"key":"EOH54OkTUR"},{"type":"link","url":"#fg_scratch","position":{"start":{"line":471,"column":1},"end":{"line":471,"column":1}},"children":[{"type":"text","value":"(Figure 1)","position":{"start":{"line":471,"column":1},"end":{"line":471,"column":1}},"key":"RVUeCNhFkQ"}],"urlSource":"#fg_scratch","key":"n7UZGbnUsY"},{"type":"text","value":" for our finite horizon discrete LQR problem can be readily extended to LQG, iLQR, DDP, and reinforcement\nlearning using non-deterministic dynamics factors, nonlinear factors, discrete factor graphs, and other features of GTSAM (stay tuned for future posts).","position":{"start":{"line":471,"column":1},"end":{"line":471,"column":1}},"key":"jG6XIUJuow"}],"key":"M2rHF9Vm9I"},{"type":"break","key":"BxbM49KwtU"},{"type":"thematicBreak","key":"xmFrHm31EL"},{"type":"break","key":"lJfT3NHprP"},{"type":"comment","value":" ********************************** APPENDIX ********************************** ","key":"GKlxarA9KE"},{"type":"heading","depth":2,"position":{"start":{"line":479,"column":1},"end":{"line":479,"column":1}},"children":[{"type":"text","value":"Appendix","position":{"start":{"line":479,"column":1},"end":{"line":479,"column":1}},"key":"bpL7ifgSOy"}],"identifier":"appendix","label":"Appendix","html_id":"appendix","implicit":true,"key":"PmwizivD6g"},{"type":"comment","value":" ### Marginalization Cost on $x_1$\nBy substituting \\eqref{eq:control_law} into \\eqref{eq:potential_simplified}, we have the updated\npotential function as a function of only $x_1$:\n\\\\[ \\begin{aligned} \n    \\phi_1(x_1) &= x_1^T Q x_1 + (K_1x_1)^T RK_1x_1 + (Ax_1 + BKx_1)^T Q (Ax_1 + BKx_1) \\\\\\\\ \n    &= x_1^T(Q+ K_1^TRK_1 + A^TQA + K_1^TB^TQB - K_1^TB^TQA - A^TQBK_1)x_1  \\\\\\\\ \n    &= x_1^T[Q + A^TQA + K_1^T(R+B^TQB)K_1 - K_1^TB^TQA - A^TQBK_1]x_1 \\\\\\\\ \n    &= x_1^T(Q + A^TQA + A^TQBK_1 - K_1^TB^TQA - A^TQBK_1)x_1 \\\\\\\\ \n    &= x_1^T(Q + A^TQA - K_1^TB^TQA)x_1 \n\\end{aligned} \\\\] ","key":"LqSSyxbWNi"},{"type":"heading","depth":3,"position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"children":[{"type":"text","value":"Least Squares Implementation in GTSAM","position":{"start":{"line":492,"column":1},"end":{"line":492,"column":1}},"key":"U1tSQC3Qhf"}],"identifier":"least-squares-implementation-in-gtsam","label":"Least Squares Implementation in GTSAM","html_id":"least-squares-implementation-in-gtsam","implicit":true,"key":"fX9b6uRY7y"},{"type":"paragraph","position":{"start":{"line":493,"column":1},"end":{"line":494,"column":1}},"children":[{"type":"text","value":"GTSAM can be specified to use either of two methods for solving the least squares problems that\nappear in eliminating factor graphs: Cholesky Factorization or QR Factorization.  Both arrive at the same result, but we will take a look at QR since it more immediately illustrates the elimination algorithm at work.","position":{"start":{"line":493,"column":1},"end":{"line":493,"column":1}},"key":"kV8LuJ5Awj"}],"key":"EcOBgUHOBw"},{"type":"comment","value":" plain table for formatting purposes ","key":"ja8K4EPmBA"},{"type":"heading","depth":4,"children":[{"type":"text","value":"QR Factorization","key":"MO9gk376xm"}],"identifier":"qr-factorization","label":"QR Factorization","html_id":"qr-factorization","implicit":true,"key":"pSObvswq4W"},{"type":"paragraph","children":[{"type":"link","url":"","children":[],"urlSource":"","key":"luqu7RnlAJ"}],"key":"nW4ljNadyF"},{"type":"div","class":"slideshow-container","style":{"minHeight":"3in"},"children":[{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide0-86f01375ce34436015061aeca42150d1.png","alt":"factor graph partially eliminated","key":"hzV5Gf3HQY","urlSource":"/_static/lqr_control/Elimination/cropped_Slide0.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6a","key":"X5MLhgTgdM"}],"key":"FvItCtz4Bn"},{"type":"text","value":" Initial factor graph and elimination matrix","key":"SvTq6nRH5N"}],"key":"uMcyvPyrSV"}],"key":"oQevxfc2xA"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\left[ \\begin{array}{c} \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{-A | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I \\end{array} \\right] & \\left[ \\begin{array}{ccccc|c} Q^{1/2} & & & & & 0\\\\\\\\ I & -B & -A & & & 0\\\\\\\\ & R^{1/2} & & & & 0\\\\\\\\ & & Q^{1/2}& & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"SUvuxZkuMe"}],"key":"X3o3d7WwJI"}],"key":"nNJLhDasds"}],"enumerator":"3","key":"dyVuBJGalO"}],"key":"wxChqVXSZ7"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide1-f0cab43934a673704c1943bc28506770.png","alt":"factor graph partially eliminated","key":"wN9mtz5dBl","urlSource":"/_static/lqr_control/Elimination/cropped_Slide1.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6b","key":"lqjm7ycPzE"}],"key":"yZUbcrGZba"},{"type":"text","value":" Eliminate $x_2$: the two factors to replace are highlighted in red","key":"LuLWwwKR7o"}],"key":"x0XwTAK7n0"}],"key":"SlI5D8tefh"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I \\end{bmatrix} & \\left[ \\begin{array}{ccccc|c} \\color{red} {Q^{1/2}} & & & & & 0\\\\\\\\ \\color{red} I & \\color{red} {-B} & \\color{red} {-A} & & & 0\\\\\\\\ & R^{1/2} & & & & 0\\\\\\\\ & & Q^{1/2}& & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"Rtnnpnwyni"}],"key":"ZAWUBdirU6"}],"key":"o1tDsliB6Q"}],"enumerator":"4","key":"LnrI0jXlsn"}],"key":"D1KlPdhli0"}],"key":"Y91DxvoQf1"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide2-0e69bdaf59fba252669050f92b2cdd44.png","alt":"factor graph partially eliminated","key":"xv9K5NwlZE","urlSource":"/_static/lqr_control/Elimination/cropped_Slide2.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6c","key":"ovaPQCo0mY"}],"key":"i9N42R0kCG"},{"type":"text","value":" Eliminated $x_2$: the resulting binary cost factor is highlighted in blue","key":"zEk0XczuK9"}],"key":"uADIlz4ST7"}],"key":"JdazpofnAA"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{c:cccc|c} I & -B & -A & & & 0\\\\\\\\ \\hdashline & \\color{blue} {Q^{1/2}B} & \\color{blue} {Q^{1/2}A} & & & 0\\\\\\\\ & R^{1/2} & & & & 0\\\\\\\\ & & Q^{1/2}& & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"CLysVEqqBU"}],"key":"SKu61cYaLJ"}],"key":"oFrUgz4dWl"}],"enumerator":"5","key":"lGsCdeDPLw"}],"key":"emZ6oTsHIJ"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide3-74da1661bc15bc9c4eee76f89ced7888.png","alt":"factor graph partially eliminated","key":"PayjexkKmr","urlSource":"/_static/lqr_control/Elimination/cropped_Slide3.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6d","key":"uaEQykG2PR"}],"key":"vbHrYpPSDE"},{"type":"text","value":" Eliminate $u_1$: the two factors to replace are highlighted in red","key":"kbiuuUtyFa"}],"key":"oxnGmto5Qd"}],"key":"xOVQyDIkJB"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{c:cccc|c} I & -B & -A & & & 0\\\\\\\\ \\hdashline & \\color{red} {Q^{1/2}B} & \\color{red} {Q^{1/2}A} & & & 0\\\\\\\\ & \\color{red} {R^{1/2}} & & & & 0\\\\\\\\ & & {Q^{1/2}} & & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"IOY9XA7r6M"}],"key":"DnHayHLHXW"}],"key":"Sfav5h265o"}],"enumerator":"6","key":"PMEtfpqJ1k"}],"key":"JKao2iOYQa"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide4-615973f4c93e4a284ac797d4ed82d25b.png","alt":"factor graph partially eliminated","key":"j2A1SI0gFS","urlSource":"/_static/lqr_control/Elimination/cropped_Slide4.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6e","key":"UW8fO0atHc"}],"key":"ePR6wJsQZq"},{"type":"text","value":" Eliminated $u_1$: the resulting unary cost factor on $x_1$ is shown in blue","key":"UGQSEdyFUK"}],"key":"PEhn4cDg48"}],"key":"cuIVAGkGVJ"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2} | } I\\\\\\\\ \\vphantom{(P_1-Q)^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{cc:ccc|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1 & & & 0\\\\\\\\ \\hdashline & & \\color{blue} {(P_1-Q)^{1/2}} & & & 0\\\\\\\\ & & Q^{1/2} & & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"rJkc3Qaja5"}],"key":"Py7JeKm565"}],"key":"WcQd0TcHU4"}],"enumerator":"7","key":"R2vUnN15wF"}],"key":"R9CeqU4gf4"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide6-05ed31f2a24784850b935698eea5b877.png","alt":"factor graph partially eliminated","key":"knDWmB6v2q","urlSource":"/_static/lqr_control/Elimination/cropped_Slide6.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6f","key":"FKutI7JMIW"}],"key":"ItaKK1ouqX"},{"type":"text","value":" Eliminate $x_1$: the three factors to replace are highlighted in red","key":"enH0BKuMBp"}],"key":"AL03zo0ksf"}],"key":"r0oHuItez7"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2} | } I\\\\\\\\ \\vphantom{(P_1-Q)^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{R^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{cc:ccc|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1 & & & 0\\\\\\\\ \\hdashline & & \\color{red} {(P_1-Q)^{1/2}} & & & 0\\\\\\\\ & & \\color{red} {Q^{1/2}} & & & 0\\\\\\\\ & & \\color{red} I & \\color{red} {-B} & \\color{red} {-A} & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"afcBr9jVYt"}],"key":"Uz3spbktIM"}],"key":"kUkCXITMy2"}],"enumerator":"8","key":"Y4ZWJA0UVT"}],"key":"C75r74zaGO"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide7-5bdda261f1c918732fd9ec025d0fdca5.png","alt":"factor graph partially eliminated","key":"mYX2VElkix","urlSource":"/_static/lqr_control/Elimination/cropped_Slide7.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6g","key":"JQTKZXwJy2"}],"key":"bLOVQk8H6v"},{"type":"text","value":" Eliminated $x_1$: the resulting binary cost factor is shown in blue","key":"eWUJ91beqb"}],"key":"rfvZVazDkh"}],"key":"XQxK0OhQCM"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2}K_1 | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_0^{1/2} | } I\\\\\\\\ \\vphantom{P^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{ccc:cc|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1& & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ \\hdashline & & &\\color{blue} {P_1^{1/2}B} & \\color{blue} {P_1^{1/2}A} & 0\\\\\\\\ & & & R^{1/2}& & 0\\\\\\\\ & & & & Q^{1/2}& 0 \\end{array} \\right] \\end{array} \\\\)","key":"E6wC1ysj8d"}],"key":"FvPARJqkRX"}],"key":"BKV3XE1Sgb"}],"enumerator":"9","key":"YAstYqAEyP"}],"key":"orcP9v7Zqy"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide8-b0ffe9315cdd50dd19bae917c8722667.png","alt":"factor graph partially eliminated","key":"QSwJMwMpea","urlSource":"/_static/lqr_control/Elimination/cropped_Slide8.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6h","key":"Nn5M1S5NSA"}],"key":"QH7vbDSQGa"},{"type":"text","value":" Eliminate $u_0$: the two cost factors to replace are shown in red","key":"NbuMqIDLJC"}],"key":"NYu1MFfv8q"}],"key":"rkGhTvb091"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2}K_1 | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_0^{1/2} | } I\\\\\\\\ \\vphantom{P^{1/2} | } I\\\\\\\\ \\vphantom{Q^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{ccc:cc|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1& & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ \\hdashline & & &\\color{red} {P_1^{1/2}B} &\\color{red} {P_1^{1/2}A} & 0\\\\\\\\ & & &\\color{red} {R^{1/2}} & & 0\\\\\\\\ & & & & Q^{1/2} & 0 \\end{array} \\right] \\end{array} \\\\)","key":"KHbKvanKWD"}],"key":"uVsECQlLn4"}],"key":"X2IPYnpk2O"}],"enumerator":"10","key":"cDB7n1HCYV"}],"key":"sz7RmP8CIG"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide9-4b494e447bcea9fa9430a729216b2cae.png","alt":"factor graph partially eliminated","key":"cZqTUOU61y","urlSource":"/_static/lqr_control/Elimination/cropped_Slide9.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6i","key":"wKssLvAG3Y"}],"key":"aAWikunyYm"},{"type":"text","value":" Eliminated $u_0$: the resulting unary cost factor on $x_0$ is shown in blue.","key":"pczMZIwrna"}],"key":"Zpqb4TQ5ne"}],"key":"hR25wRxM4P"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2}K_1 | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_0^{1/2} | } I\\\\\\\\ \\vphantom{(P_0-Q)^{1/2} | } I\\\\\\\\ \\vphantom{P^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{cccc:c|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1 & & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & D_0^{1/2} & -D_0^{1/2}K_0 & 0\\\\\\\\ \\hdashline & & & & \\color{blue} {(P_0-Q)^{1/2}} & 0\\\\\\\\ & & & & Q^{1/2} & 0\\\\\\\\ \\end{array} \\right] \\end{array} \\\\)","key":"XzaAOFzH4n"}],"key":"JWI3FpwAWG"}],"key":"Pd4uDF3Y6Y"}],"enumerator":"11","key":"Ro0cHAbFGE"}],"key":"dtnk1TJ0kl"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide10-5d3ad4533749822118bdaeb405ba26be.png","alt":"factor graph partially eliminated","key":"BCD7Hz5tq8","urlSource":"/_static/lqr_control/Elimination/cropped_Slide10.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6j","key":"WpidL57voK"}],"key":"oqgQfXGM3g"},{"type":"text","value":" Eliminate $x_0$: the final two factors to eliminate are shown in red.","key":"vumfYxkmZU"}],"key":"DbYd8TRd4N"}],"key":"PcQEvSa7we"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2}K_1 | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_0^{1/2} | } I\\\\\\\\ \\vphantom{(P_0-Q)^{1/2} | } I\\\\\\\\ \\vphantom{P^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{cccc:c|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1 & & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & D_0^{1/2} & -D_0^{1/2}K_0 & 0\\\\\\\\ \\hdashline & & & & \\color{red} {(P_0-Q)^{1/2}} & 0\\\\\\\\ & & & & \\color{red} {Q^{1/2}} & 0\\\\\\\\ \\end{array} \\right] \\end{array} \\\\)","key":"yWg1BscxWA"}],"key":"vrnLrvtmOu"}],"key":"sdN4XmRBKF"}],"enumerator":"12","key":"JR38x8xaOB"}],"key":"WvOXDHPKMN"},{"type":"div","class":"mySlides 1","style":{"textAlign":"center"},"children":[{"type":"container","class":"center","style":{"width":"75%"},"children":[{"type":"image","url":"/cropped_Slide11-b2400a62e4e639258fa8e580ab3f1e41.png","alt":"factor graph partially eliminated","key":"Vt2S4yQKd8","urlSource":"/_static/lqr_control/Elimination/cropped_Slide11.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 6k","key":"gv7CpHDOm1"}],"key":"d3K4juFgUm"},{"type":"text","value":" Final result: after eliminating $x_0$, the elimination matrix is upper-triangular and we can read off the control laws.","key":"ZOss1l9Xqn"}],"key":"jm3MrohA3u"}],"key":"DWB0wQmone"},{"type":"legend","children":[{"type":"div","style":{"width":"100%","height":"2.6in","overflow":"auto"},"children":[{"type":"text","value":"\\\\( \\begin{array}{cc} \\text{NM} & \\text{Elimination Matrix} \\\\\\\\ \\begin{bmatrix} \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_1^{1/2}K_1 | } I\\\\\\\\ \\vphantom{I | } 0\\\\\\\\ \\vphantom{D_0^{1/2} | } I\\\\\\\\ \\vphantom{P_0^{1/2} | } I\\\\\\\\ \\end{bmatrix} & \\left[ \\begin{array}{cccc:c|c} I & -B & -A & & & 0\\\\\\\\ & D_1^{1/2} & -D_1^{1/2}K_1 & & & 0\\\\\\\\ & & I & -B & -A & 0\\\\\\\\ & & & D_0^{1/2} & -D_0^{1/2}K_0 & 0\\\\\\\\ \\hdashline & & & & \\color{blue} {P_0^{1/2}} & 0\\\\\\\\ \\end{array} \\right] \\end{array} \\\\)","key":"i5G66JFTDx"}],"key":"m38yYVfjl4"}],"key":"EhR6rSqgsL"}],"enumerator":"13","key":"q7gS9F95u2"}],"key":"S6VBPDRsSO"},{"type":"paragraph","children":[{"type":"link","class":"prev","url":"","children":[{"type":"text","value":"❮","key":"jLUjUdDjkJ"}],"urlSource":"","key":"VZCgHHT7My"},{"type":"text","value":" ","key":"XQdvxNGeWj"},{"type":"link","class":"next","url":"","children":[{"type":"text","value":"❯","key":"YUvt1ni7TS"}],"urlSource":"","key":"NIq6fnrkYf"}],"key":"h3nYsJbMZY"},{"type":"comment","value":" slideshow-container ","key":"FjGluCsRdx"},{"type":"comment","value":" ************************ QR block elimination ************************ ","key":"sOwLfUguKS"},{"type":"comment","value":" Slideshow container, based on https://www.w3schools.com/howto/howto_js_slideshow.asp ","key":"gvF1IrA0Zl"},{"type":"comment","value":" Next and previous buttons ","key":"EcbIzTtRzs"},{"type":"comment","value":" The dots/circles ","key":"F2fCsxIsiE"},{"type":"div","style":{"textAlign":"center"},"children":[{"type":"span","class":"dot 1","children":[],"key":"sC2jbkey3t"},{"type":"span","class":"dot 1","children":[],"key":"fAcJxVMYh5"},{"type":"span","class":"dot 1","children":[],"key":"UDV9VoZPX7"},{"type":"span","class":"dot 1","children":[],"key":"yQutqg69YY"},{"type":"span","class":"dot 1","children":[],"key":"uxIp5Gb1xW"},{"type":"span","class":"dot 1","children":[],"key":"n8CA8Ykiqa"},{"type":"span","class":"dot 1","children":[],"key":"VJaJWvQeto"},{"type":"span","class":"dot 1","children":[],"key":"QAM1CugOlB"},{"type":"span","class":"dot 1","children":[],"key":"lBCZvMTgB7"},{"type":"span","class":"dot 1","children":[],"key":"zGTIuoQLGE"},{"type":"span","class":"dot 1","children":[],"key":"PegckKx9DF"}],"key":"qm6jjHwibw"},{"type":"break","key":"f3uUi2z11P"},{"type":"div","style":{"overflow":"auto"},"children":[{"type":"table","style":{"width":"6.1in","margin":"0 auto"},"children":[{"type":"tableRow","children":[{"type":"tableCell","header":true,"children":[{"type":"text","value":"where","key":"aiyGaOUhbY"}],"key":"cNxeY4m1O8"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$P_{k}$","key":"hqJly1GVFK"}],"key":"MmminVyyYS"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$=$","key":"po89qUbUiC"}],"key":"X1bICgx1Ux"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$Q + A^TP_{k+1}A - K_k^TB^TP_{k+1}A$","key":"trA7pVJCNl"}],"key":"BWn7R4k1Ka"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"($P_2=Q$)","key":"mcuxMyFT4h"}],"key":"leTmAmUczA"}],"key":"wwpEMG00nL"},{"type":"tableRow","children":[{"type":"tableCell","header":true,"children":[],"key":"Rl6d4OMYY2"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$D_{k}$","key":"GfQJbQbuEX"}],"key":"neZonNWdXN"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$=$","key":"LmhjbkQJae"}],"key":"Zfdi7zaeuF"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$R + B^TP_{k+1}B$","key":"PiBtUzyRhi"}],"key":"ptvcncn0dl"}],"key":"HIyx0pC4KH"},{"type":"tableRow","children":[{"type":"tableCell","header":true,"children":[],"key":"SrOJEihedK"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$K_k$","key":"DUnSDGjOx1"}],"key":"ZwbkUiA2pT"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$=$","key":"Xy1NkRux8f"}],"key":"DJoxmsFgs0"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$-D_{k}^{-1/2}(R + B^TP_{k+1}B)^{-T/2}B^TP_{k+1}A$","key":"iXR5ErN3g1"}],"key":"FLxNCQrEb5"}],"key":"bwO6U1hKTo"},{"type":"tableRow","children":[{"type":"tableCell","header":true,"children":[],"key":"OVsuv0yqQB"},{"type":"tableCell","header":true,"children":[],"key":"Y7Aaa9rPIY"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$=$","key":"YFzfMiINM1"}],"key":"ki4xdfSZuA"},{"type":"tableCell","header":true,"children":[{"type":"text","value":"$-(R + B^TP_{k+1}B)^{-1}B^TP_{k+1}A$","key":"iYrMPiSY4a"}],"key":"G7cEG46ayO"}],"key":"SeuAEbSi7j"}],"key":"NatTEUSNOI"}],"key":"SjOYkPsOZX"},{"type":"comment","value":" ************************ end QR block elimination ************************ ","key":"q0qwDDbNXW"},{"type":"break","key":"Mq95DWOKti"},{"type":"paragraph","position":{"start":{"line":885,"column":1},"end":{"line":890,"column":1}},"children":[{"type":"text","value":"The factorization process is illustrated in ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"sLSt8LC2Y6"},{"type":"link","url":"#fig:qr_elim","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"children":[{"type":"text","value":"Figure 6","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"F60Ifpkjso"}],"urlSource":"#fig:qr_elim","key":"XLLKKMS6JX"},{"type":"text","value":" for a 3-time step factor graph, where the noise matrices and elimination\nmatrices are shown with the corresponding states of the graph.  The noise matrix (NM) is ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"s2FlxALj1y"},{"type":"text","value":"0","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"lsu7rnuULj"},{"type":"text","value":" for a\nhard constraint and ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"fqaEru6xDh"},{"type":"inlineMath","value":"I","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>I</mi></mrow><annotation encoding=\"application/x-tex\">I</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07847em;\">I</span></span></span></span>","key":"rg8ApgKsm1"},{"type":"text","value":" for a minimization objective.  The elimination matrix is formatted as an\naugmented matrix ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"bNoA3KIuZh"},{"type":"inlineMath","value":"[A|b]","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mi>A</mi><mi mathvariant=\"normal\">∣</mi><mi>b</mi><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">[A|b]</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord mathnormal\">A</span><span class=\"mord\">∣</span><span class=\"mord mathnormal\">b</span><span class=\"mclose\">]</span></span></span></span>","key":"csLYoriTfm"},{"type":"text","value":" for the linear least squares problem ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"RcauCsoCZC"},{"type":"inlineMath","value":"\\argmin\\limits_x\\|\\|Ax-b\\|\\|_2^2","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><munder><mrow><mi mathvariant=\"normal\">arg min</mi><mo>⁡</mo></mrow><mi>x</mi></munder><mi mathvariant=\"normal\">∥</mi><mi mathvariant=\"normal\">∥</mi><mi>A</mi><mi>x</mi><mo>−</mo><mi>b</mi><mi mathvariant=\"normal\">∥</mi><msubsup><mi mathvariant=\"normal\">∥</mi><mn>2</mn><mn>2</mn></msubsup></mrow><annotation encoding=\"application/x-tex\">\\argmin\\limits_x\\|\\|Ax-b\\|\\|_2^2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.6444em;vertical-align:-0.8944em;\"></span><span class=\"mop op-limits\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6679em;\"><span style=\"top:-2.2056em;margin-left:0em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span><span class=\"mop\"><span class=\"mord mathrm\" style=\"margin-right:0.01389em;\">arg</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathrm\">min</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8944em;\"><span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">∥∥</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mord\">∥</span><span class=\"mord\"><span class=\"mord\">∥</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-2.4519em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2481em;\"><span></span></span></span></span></span></span></span></span></span>","key":"m4NoxgSSqK"},{"type":"text","value":"\nwith ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"iNG0yLqb9w"},{"type":"inlineMath","value":"{x=[x_2;u_1;x_1;u_0;x_0]}","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>x</mi><mo>=</mo><mo stretchy=\"false\">[</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator=\"true\">;</mo><msub><mi>u</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator=\"true\">;</mo><msub><mi>u</mi><mn>0</mn></msub><mo separator=\"true\">;</mo><msub><mi>x</mi><mn>0</mn></msub><mo stretchy=\"false\">]</mo></mrow><annotation encoding=\"application/x-tex\">{x=[x_2;u_1;x_1;u_0;x_0]}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mopen\">[</span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">]</span></span></span></span></span>","key":"NJdy3oq4Vj"},{"type":"text","value":" is the vertical concatenation of all state and control vectors.\nThe recursive expressions for ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"V3B732mpSO"},{"type":"inlineMath","value":"P","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>P</mi></mrow><annotation encoding=\"application/x-tex\">P</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">P</span></span></span></span>","key":"LCw1Fq4kqr"},{"type":"text","value":", ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"NcSCC6j0kD"},{"type":"inlineMath","value":"D","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>D</mi></mrow><annotation encoding=\"application/x-tex\">D</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span></span></span></span>","key":"qGmF7blfxO"},{"type":"text","value":", and ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"oL00jjT6oA"},{"type":"inlineMath","value":"K","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>K</mi></mrow><annotation encoding=\"application/x-tex\">K</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">K</span></span></span></span>","key":"pISIBrW9ga"},{"type":"text","value":" when eliminating control variables (i.e. ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"uGXzGZ6KLj"},{"type":"inlineMath","value":"u_1","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>u</mi><mn>1</mn></msub></mrow><annotation encoding=\"application/x-tex\">u_1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">u</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"oO2XNCRrEm"},{"type":"text","value":" in ","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"jYFr8cvwgJ"},{"type":"link","url":"#fig:qr_elim","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"children":[{"type":"text","value":"Figure 6e","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"jX4rx4ozgP"}],"urlSource":"#fig:qr_elim","key":"CbndEenHtb"},{"type":"text","value":"{:onclick=“currentSlide(5,1)”}) are derived from block QR Factorization.","position":{"start":{"line":885,"column":1},"end":{"line":885,"column":1}},"key":"N5IGdmT6Yu"}],"key":"IDYWja0Fv4"},{"type":"paragraph","position":{"start":{"line":892,"column":1},"end":{"line":894,"column":1}},"children":[{"type":"text","value":"Note that all ","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"key":"MSP9UvNf6A"},{"type":"inlineMath","value":"b_i=0","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding=\"application/x-tex\">b_i=0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0</span></span></span></span>","key":"fJSYUgcY3Q"},{"type":"text","value":" in the augmented matrix for the LQR problem of finding minimal control to\nreach state ","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"key":"t5NZQ1j8Iy"},{"type":"text","value":"0","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"key":"P2LEDCchew"},{"type":"text","value":", but simply changing values of ","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"key":"GdcjBXSw94"},{"type":"inlineMath","value":"b_i","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">b_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"wUGYTQiaxk"},{"type":"text","value":" intuitively extends GTSAM to solve\nLQR problems whose objectives are to reach different states or even follow trajectories.","position":{"start":{"line":892,"column":1},"end":{"line":892,"column":1}},"key":"kNAJLoAnm6"}],"key":"UDWbJY4TFM"},{"type":"comment","value":" ### Final Symbolic Expressions of Factor Graph Evaluation\nIn the above solution, we have\n\\\\[ \\begin{aligned} \nK_1 &= -(R+B^TQB)^{-1}B^TQA\\\\\\\\ \nP_1 &= Q+A^TQA + A^TQBK_1\\\\\\\\ \nK_0 &= -(R+B^TV_1B)^{-1}B^TV_1A\\\\\\\\ \nP_0 &= Q + A^T V_1 A + A^T V_1 B K_0\n\\end{aligned} \\\\]\n\nIn general, the above factor graph and solution method can be expanded for an arbitrary number of time steps, $T$, arising in the iterative equations\n\\\\[ \\begin{aligned} \n    V_T &= Q \\\\\\\\ \n    K_t &= -( R + B^T V_{t+1} B )^{-1} B^T V_{t+1} A \\\\\\\\ \n    P_t &= Q + A^T V_{t+1} A + A^T V_{t+1} B K_t \n\\end{aligned} \\\\]\nand\n\\\\[ \\begin{aligned} \n    u_t &= K_t x_t\n\\end{aligned} \\\\]\nwhich match the traditional algorithm using the Ricatti Equation for solving the finite-horizon discrete-time LQR problem.  As the number\nof time steps grows, the solution for $V_0$ approaches the stationary solution to the algebraic\nRicatti equation and the solution for $K_0$ approaches the solution to the infinite-horizon\ndiscrete-time LQR problem. ","key":"lSGS0QqRld"},{"type":"comment","value":" **************** JAVASCRIPT FOR SLIDESHOWS **************** ","key":"MQeo6oKqKX"}],"key":"TPqKrz00mp"}],"key":"BBcsTc9b2x"},"references":{"cite":{"order":[],"data":{}}}}