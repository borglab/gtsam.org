{"version":1,"kind":"Article","sha256":"ab524511a12534d4d84794288f655ff3c7df71b7cac544f2a53aff37de67f8e4","slug":"content.blogs.2019.2019-09-20-robust-noise-model","location":"/Content/Blogs/2019/2019-09-20-robust-noise-model.md","dependencies":[],"frontmatter":{"title":"Look Ma, No RANSAC","github":"https://github.com/borglab/gtsam","numbering":{"title":{"offset":2}},"edit_url":"https://github.com/borglab/gtsam/blob/docs/ktk-sdk/Content/Blogs/2019/2019-09-20-robust-noise-model.md","thumbnail":"/se2_matches-4738bfc995d1fff8cd708542094cec7a.png","exports":[{"format":"md","filename":"2019-09-20-robust-noise-model.md","url":"/2019-09-20-robust-no-f7d738149fd9a8bb2a8a0f577fbf0e8e.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Author: Varun Agrawal","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ioKZqAVCMI"},{"type":"break","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"R0YxLfseiO"},{"type":"text","value":"Website: ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xjWBkAFf17"},{"type":"link","url":"https://varunagrawal.github.io","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"varunagrawal​.github​.io","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"V4RX1JAliP"}],"urlSource":"https://varunagrawal.github.io","key":"GKWq79ojgq"}],"key":"ddPGlcR0HZ"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"(","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"C4x1ssKEfG"},{"type":"emphasis","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"strong","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Psst","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"vru3SrbUOg"}],"key":"Ivo7iK56xN"},{"type":"text","value":", be sure to clone/download GTSAM 4.0.2 which resolves a bug in the Huber model discussed below, for correct weight behavior","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"j9LhVdwEp3"}],"key":"g01hbnRmTA"},{"type":"text","value":")","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sYolKXv8rN"}],"key":"pYgrcdprSM"},{"type":"heading","depth":2,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Introduction","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"mxZWHRdDBg"}],"identifier":"introduction","label":"Introduction","html_id":"introduction","implicit":true,"key":"ddHnKz79iC"},{"type":"container","class":"center","children":[{"type":"image","url":"/se2_matches-4738bfc995d1fff8cd708542094cec7a.png","alt":"Matches between books","key":"VtJrUzwRuk","urlSource":"/_static/robust_estimators/se2_matches.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 1","key":"ZaPap8Oa12"}],"key":"lNPDpM4Q5e"},{"type":"text","value":" Two books on a plane separated by an SE(2) transform, and some manually selected feature matches between them. There are some clearly incorrect matches, which are ","key":"thWyx0lDYb"},{"type":"strong","children":[{"type":"text","value":"outliers","key":"PLWxtWw2WE"}],"key":"M34DVcFS9Z"},{"type":"text","value":".","key":"jd0oOLO1he"}],"key":"dosidkdeXG"}],"key":"VgQDODhitR"}],"enumerator":"1","key":"x8kdBn9bDR"},{"type":"paragraph","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Robust error models are powerful tools for supplementing parameter estimation algorithms with the added capabilities of modeling outliers. Parameter estimation is a fundamental tool used in many fields, especially in perception and robotics, and thus performing robust parameter estimation across a wide range of applications and scenarios is crucial to strong performance for many applications. This necessitates the need to manage outliers in our measurements, and robust error models provide us the means to do so. Robust error models are amenable to easy plug-and-play use in pre-existing optimization frameworks, requiring minimal changes to existing pipelines.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"ZrOxdT7hRb"}],"key":"hVcA7SXbt3"},{"type":"paragraph","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Using robust error models can even obviate the need for more complex, non-deterministic algorithms such as Random Sample Consensus (a.k.a. RANSAC), a fundamental tool for parameter estimation in many a roboticist’s toolbox for years. While RANSAC has proven to work well in practice, it might need a high number of runs to converge to a good solution. Robust error models are conceptually easy and intuitive and can be used by themselves or in conjunction with RANSAC.","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"iHQonZ5chm"}],"key":"PBCEsB0NHv"},{"type":"paragraph","position":{"start":{"line":24,"column":1},"end":{"line":25,"column":1}},"children":[{"type":"text","value":"In this blog post, we demonstrate the capabilities of robust error models which downweigh outliers to provide better estimates of the parameters of interest. To illustrate the benefits of robust error models, take a look at ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"vnVhgsroKv"},{"type":"strong","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"children":[{"type":"text","value":"Figure 1","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"fs2f7P564x"}],"key":"AC54Gims8y"},{"type":"text","value":". We show two books next to each other, transformed by an ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"dAWchxOTav"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"PnjoPQSpQS"},{"type":"text","value":" transform, with some manually labeled point matches between the two books. We have added some outliers to more realistically model the problem.\nAs we will see later in the post, the estimates from RANSAC and a robust estimation procedure are quite similar, even though the ratio of inliers to outliers is ","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"tDKAj3suph"},{"type":"inlineMath","value":"2:1","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>2</mn><mo>:</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2:1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">2</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>","key":"fBm3VJzY9e"},{"type":"text","value":".","position":{"start":{"line":24,"column":1},"end":{"line":24,"column":1}},"key":"EDbC0Ka9ek"}],"key":"seg94YE3DG"},{"type":"heading","depth":2,"position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"children":[{"type":"text","value":"Parameter Estimation - A Short Tutorial","position":{"start":{"line":27,"column":1},"end":{"line":27,"column":1}},"key":"ku60KpADAp"}],"identifier":"parameter-estimation-a-short-tutorial","label":"Parameter Estimation - A Short Tutorial","html_id":"parameter-estimation-a-short-tutorial","implicit":true,"key":"s0B1LqinFb"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"We begin by reviewing techniques for parameter estimation as outlined by the ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"kFbSxIfNdQ"},{"type":"link","url":"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/RR-2676.pdf","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"tutorial by Zhengyou Zhang","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"y0qgBVwAKr"}],"urlSource":"https://www.microsoft.com/en-us/research/wp-content/uploads/2016/11/RR-2676.pdf","key":"UIK4OD6ZWd"},{"type":"text","value":", as applied to our ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"PLuS57Hfga"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"ZboCNNfFC6"},{"type":"text","value":". Given some matches ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"xrDhQTB7tK"},{"type":"inlineMath","value":"\\{(s,s')\\}","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">{</mo><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">}</mo></mrow><annotation encoding=\"application/x-tex\">\\{(s,s&#x27;)\\}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0019em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)}</span></span></span></span>","key":"hvgXSJX36E"},{"type":"text","value":" between the two images, we want to estimate the the ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"anfCZAJCUH"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"OSMvJhQ2do"},{"type":"text","value":" parameters ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"x3i9JpsGMA"},{"type":"text","value":"θ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"QpKpzyUk8I"},{"type":"text","value":" that transform a feature ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"UHEwyzmbDC"},{"type":"inlineMath","value":"s","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"EQS7b1ZIRc"},{"type":"text","value":" in the first image to a feature ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"L2VAsj5ZEk"},{"type":"inlineMath","value":"s'","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msup></mrow><annotation encoding=\"application/x-tex\">s&#x27;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7519em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span></span></span></span></span></span></span></span>","key":"qBtlszLYmL"},{"type":"text","value":" in the  second image:","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"RUzsXCLspy"}],"key":"fA70Ty8HTa"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"\\[ s’ = f(\\theta ; s) \\]","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"VauzrBd9XG"}],"key":"XQMlnUh1Yq"},{"type":"paragraph","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"Of course, this generalizes to other transformations, including 3D-2D problems. This is a ubiquitous problem seen in multiple domains of perception and robotics and is referred to as ","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"ws0NooKJie"},{"type":"strong","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"text","value":"parameter estimation","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"mZnZdLeqNo"}],"key":"JP7J1g8myo"},{"type":"text","value":".","position":{"start":{"line":33,"column":1},"end":{"line":33,"column":1}},"key":"uhmoLE0d6q"}],"key":"FbvnpIC7Lz"},{"type":"paragraph","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"A standard framework to estimate the parameters is via the Least-Squares formulation. We usually have many more observations than we have parameters, i.e., the problem is now overdetermined. To handle this, we minimize the sum of square ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"bj3pX3jkXE"},{"type":"strong","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"text","value":"residuals","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"yW9fMNA8lt"}],"key":"Xnlw2PuXeD"},{"type":"text","value":" ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"nWLABjggrw"},{"type":"inlineMath","value":"f(\\theta ; s_i) - s'_i","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>θ</mi><mo separator=\"true\">;</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy=\"false\">)</mo><mo>−</mo><msubsup><mi>s</mi><mi>i</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">′</mo></msubsup></mrow><annotation encoding=\"application/x-tex\">f(\\theta ; s_i) - s&#x27;_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mpunct\">;</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.0106em;vertical-align:-0.2587em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-2.4413em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">′</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2587em;\"><span></span></span></span></span></span></span></span></span></span>","key":"zNWAAC0fU9"},{"type":"text","value":", for ","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"tNbcOQEMxZ"},{"type":"inlineMath","value":"i\\in1\\ldots N","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mo>∈</mo><mn>1</mn><mo>…</mo><mi>N</mi></mrow><annotation encoding=\"application/x-tex\">i\\in1\\ldots N</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6986em;vertical-align:-0.0391em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">∈</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\">…</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span></span></span></span>","key":"QaRrIgKRqg"},{"type":"text","value":":","position":{"start":{"line":35,"column":1},"end":{"line":35,"column":1}},"key":"t25AgbK4OJ"}],"key":"sjea7bOp8v"},{"type":"paragraph","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"children":[{"type":"text","value":"\\[ E_{LS}(\\theta) =  \\sum_i \\vert\\vert f(\\theta ; s_i) - s’_i \\vert\\vert^2 \\]","position":{"start":{"line":37,"column":1},"end":{"line":37,"column":1}},"key":"IHm7odfqxH"}],"key":"V9PWE0r88A"},{"type":"paragraph","position":{"start":{"line":39,"column":1},"end":{"line":40,"column":1}},"children":[{"type":"text","value":"which we refer to as ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"QbAckMvTee"},{"type":"strong","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"the cost function","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"NSW4YL3lM8"}],"key":"ZIm1aAkYV0"},{"type":"text","value":" or ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"ZPlK3BBxAJ"},{"type":"strong","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"the objective function","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"LWIEP2ojwf"}],"key":"hhnwoxMdfS"},{"type":"text","value":".\nIn the case of ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"kzUEZ37Rfu"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"lM1yfhKh1P"},{"type":"text","value":" the parameters ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"YgFUE5YD9W"},{"type":"text","value":"θ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"R8GtV4xM6W"},{"type":"text","value":" should be some parameterization of a transformation matrix, having three degrees of freedom (DOF). A simple way to accomplish this is to have ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"EHCqw9mfiG"},{"type":"inlineMath","value":"\\theta=(x,y,\\alpha)","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>θ</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo separator=\"true\">,</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\theta=(x,y,\\alpha)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span>","key":"X7LLmuZnij"},{"type":"text","value":".","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"fkuP80tcHO"}],"key":"Qq7Tijl6Wj"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Our measurement functions are generally non-linear, and hence we need to linearize the measurement function around an estimate of ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"e7yBKUwthh"},{"type":"text","value":"θ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"rUkEQd1mOs"},{"type":"text","value":". GTSAM will iteratively do so via optimization procedures such as Gauss-Newton, Levenberg-Marquardt, or Dogleg. Linearization is done via the ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"GpygTaY9yR"},{"type":"strong","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Taylor expansion","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"shX9sKatmE"}],"key":"GabzrtMocE"},{"type":"text","value":" around a linearization point ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"sN4QcDxMuz"},{"type":"inlineMath","value":"\\theta_0","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>θ</mi><mn>0</mn></msub></mrow><annotation encoding=\"application/x-tex\">\\theta_0</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">0</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"nBJDH4iM4w"},{"type":"text","value":":","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"TDrUV2Ae4l"}],"key":"sdxPJ2COit"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"\\[ f(\\theta + \\Delta\\theta; s) = f(\\theta; s) + J(\\theta; s)\\Delta\\theta \\]","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"lXcj0tnIgs"}],"key":"wMJOY525lg"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"This gives us the following linearized least squares objective function:","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"RPOPUeRnKq"}],"key":"hCz3ExmTGh"},{"type":"paragraph","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"children":[{"type":"text","value":"\\[ E_{LS, \\theta_0} = \\sum_i \\vert\\vert f(\\theta; s_i) + J(\\theta; s_i)\\Delta\\theta - s_i’ \\vert\\vert^2 \\]","position":{"start":{"line":48,"column":1},"end":{"line":48,"column":1}},"key":"VFLqTFTfaA"}],"key":"BWeC53bYbc"},{"type":"paragraph","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"children":[{"type":"text","value":"Since the above is now linear in ","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"V0QDELqSWU"},{"type":"inlineMath","value":"\\Delta\\theta","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">Δ</mi><mi>θ</mi></mrow><annotation encoding=\"application/x-tex\">\\Delta\\theta</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord\">Δ</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">θ</span></span></span></span>","key":"Nmtla3992j"},{"type":"text","value":", GTSAM can solve it using either sparse Cholesky or QR factorization.","position":{"start":{"line":50,"column":1},"end":{"line":50,"column":1}},"key":"yKfEjtTLKt"}],"key":"XOVpGeUEQp"},{"type":"heading","depth":2,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Robust Error Models","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"R2FKfCi9ow"}],"identifier":"robust-error-models","label":"Robust Error Models","html_id":"robust-error-models","implicit":true,"key":"ziXrP6l0yS"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"children":[{"type":"text","value":"We have derived the basic parameter optimization approach in the previous section and seen how the choice of the optimization function affects the optimality of our solution. However, another aspect we need to take into account is the effect of outliers on our optimization and final parameter values.","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"PXBxZJH8Zw"}],"key":"JpZOBOLjYt"},{"type":"paragraph","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"By default, the optimization objectives outlined above try to model all measurements equally. This means that in the presence of outliers, the optimization process might give us parameter estimates that try to fit these outliers, sacrificing accuracy on the inliers. More formally, given the ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"Rd83Z6BvX7"},{"type":"emphasis","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"children":[{"type":"text","value":"residual","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"I6GIqJ0Hdh"}],"key":"ed7mne2bhX"},{"type":"text","value":" ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"U6gJOjihg5"},{"type":"inlineMath","value":"r_i","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mi>r</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">r_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"dI1UkwCKVB"},{"type":"text","value":" of the ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"qBebsKjPAC"},{"type":"inlineMath","value":"i^{th}","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span>","key":"HwlN0IFQWQ"},{"type":"text","value":" match, i.e. the difference between the ","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"rfPji1asLY"},{"type":"inlineMath","value":"i^{th}","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>i</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">i^{th}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">i</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">h</span></span></span></span></span></span></span></span></span></span></span></span>","key":"px9WgnLyUQ"},{"type":"text","value":" observation and the fitted value, the standard least squares approach attempts to optimize the sum of all the squared residuals. This can lead to the estimated parameters being distorted due to the equal weighting of all data points. Surely, there must be a way for the objective to model inliers and outliers in a clever way based on the residual errors?","position":{"start":{"line":56,"column":1},"end":{"line":56,"column":1}},"key":"fQfdcqYVu7"}],"key":"pF5CBIaSPQ"},{"type":"paragraph","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"One way to tackle the presence of outliers is a family of models known as ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"rF4rWGV87R"},{"type":"strong","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"Robust Error Models","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"Lfjkk0sTvW"}],"key":"qmfo2UwwFD"},{"type":"text","value":" or ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"Gn6McdIGjM"},{"type":"strong","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"children":[{"type":"text","value":"M-estimators","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"M5MJC6wGTA"}],"key":"MScBWdXKCw"},{"type":"text","value":". The M-estimators try to reduce the effect of outliers by replacing the squared residuals with a function of the residuals ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"LTZztD5kAY"},{"type":"text","value":"ρ","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"DEjqnHYFzW"},{"type":"text","value":" that weighs each residual term by some value:","position":{"start":{"line":58,"column":1},"end":{"line":58,"column":1}},"key":"fiGcGq2ELq"}],"key":"FXzYxlPyjU"},{"type":"paragraph","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"children":[{"type":"text","value":"\\[ p = min \\sum_i^n \\rho(r_i) \\]","position":{"start":{"line":60,"column":1},"end":{"line":60,"column":1}},"key":"MWk0rVHrSp"}],"key":"dTIJ3E5cnS"},{"type":"paragraph","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"children":[{"type":"text","value":"To allow for optimization, we define ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"RUfWUpGeEK"},{"type":"text","value":"ρ","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"rNNEbkmDVY"},{"type":"text","value":" to be a symmetric, positive-definite function, thus it has a unique minimum at zero, and is less increasing than square.","position":{"start":{"line":62,"column":1},"end":{"line":62,"column":1}},"key":"ZkUN8uqXh5"}],"key":"nruhU8AwIp"},{"type":"paragraph","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"The benefit of this formulation is that we can now solve the above minimization objective as an ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"WywsBJW1Kg"},{"type":"strong","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Iteratively Reweighted Least Squares","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"dE6kCD5XZn"}],"key":"HYgMgF8sE3"},{"type":"text","value":" problem. The M-estimator of the parameter vector ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"KCOCXdVTRe"},{"type":"inlineMath","value":"p","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">p</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span></span></span></span>","key":"y1xM7abO8n"},{"type":"text","value":" based on ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"VXp4E8lxS0"},{"type":"text","value":"ρ","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"FXnNb0xUM8"},{"type":"text","value":" is the value of the parameters which solves","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"SuBsMUmeQv"}],"key":"iMKJINaFd3"},{"type":"paragraph","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"children":[{"type":"text","value":"\\[ \\sum_i \\psi(r_i)\\frac{\\delta r_i}{\\delta p_j} = 0 \\]","position":{"start":{"line":66,"column":1},"end":{"line":66,"column":1}},"key":"nKw0nc2zN0"}],"key":"YPD5lMfcoK"},{"type":"paragraph","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"for ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"gEcUhdtDwx"},{"type":"inlineMath","value":"j = 1, ..., m","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo separator=\"true\">,</mo><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mi mathvariant=\"normal\">.</mi><mo separator=\"true\">,</mo><mi>m</mi></mrow><annotation encoding=\"application/x-tex\">j = 1, ..., m</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.854em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05724em;\">j</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">...</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">m</span></span></span></span>","key":"OOalMokagJ"},{"type":"text","value":" (recall that the maximum/minimum of a function is at the point its derivative is equal to zero). Above, ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"f4gLO4WEBX"},{"type":"inlineMath","value":"\\psi(x) = \\frac{\\delta \\rho(x)}{\\delta x}","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ψ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>δ</mi><mi>ρ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><mrow><mi>δ</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\psi(x) = \\frac{\\delta \\rho(x)}{\\delta x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.355em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.01em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.485em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03785em;\">δ</span><span class=\"mord mathnormal mtight\">ρ</span><span class=\"mopen mtight\">(</span><span class=\"mord mathnormal mtight\">x</span><span class=\"mclose mtight\">)</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"Hf9jXo3a6j"},{"type":"text","value":" is called the ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"CKb1rjGWqH"},{"type":"strong","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"influence function","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"OTWviNznmx"}],"key":"cEAlgf6ll4"},{"type":"text","value":", which we can use to define a ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"OQCZHLmjIj"},{"type":"strong","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"children":[{"type":"text","value":"weight function","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"ZmxtYLY7tf"}],"key":"PgKAAVZf9N"},{"type":"text","value":" ","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"w6uxlEuuVM"},{"type":"inlineMath","value":"w(x) = \\frac{\\psi{x}}{x}","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mfrac><mrow><mi>ψ</mi><mi>x</mi></mrow><mi>x</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">w(x) = \\frac{\\psi{x}}{x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1.2772em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span>","key":"Ydu83Zh206"},{"type":"text","value":" giving the original derivative as","position":{"start":{"line":68,"column":1},"end":{"line":68,"column":1}},"key":"dEZRaFuKuX"}],"key":"Y05ahP5mwY"},{"type":"paragraph","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"\\[ \\sum_i w(r_i) r_i \\frac{\\delta r_i}{\\delta p_j} = 0 \\]","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"tSpmp1vq6q"}],"key":"f5z7Z910DN"},{"type":"paragraph","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"children":[{"type":"text","value":"which is exactly the system of equations we obtain from iterated reweighted least squares.","position":{"start":{"line":72,"column":1},"end":{"line":72,"column":1}},"key":"WYNuLSQUuJ"}],"key":"ZCkO3E0iZy"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"In layman’s terms, the influence function ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"Fmkqe3IVND"},{"type":"inlineMath","value":"\\psi(x)","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ψ</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">\\psi(x)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">ψ</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span></span></span></span>","key":"jAijsqacm3"},{"type":"text","value":" measures the influence of a data point on the value of the parameter estimate. This way, the estimated parameters are intelligent to outliers and only sensitive to inliers, since the are no longer susceptible to being significantly modified by a single match, thus making them ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"GFGfhab6W6"},{"type":"strong","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"robust","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"dNnS3xUsm0"}],"key":"pV2YuaZDo4"},{"type":"text","value":".","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"RLLq21wGyt"}],"key":"MWnbU1YFv1"},{"type":"heading","depth":3,"position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"children":[{"type":"text","value":"M-estimator Constraints","position":{"start":{"line":76,"column":1},"end":{"line":76,"column":1}},"key":"nKLrJLOONi"}],"identifier":"m-estimator-constraints","label":"M-estimator Constraints","html_id":"m-estimator-constraints","implicit":true,"key":"mzJ2iKo2PU"},{"type":"paragraph","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"While M-estimators provide us with significant benefits with respect to outlier modeling, they do come with some constraints which are required to enable their use in a wide variety of optimization problems.","position":{"start":{"line":78,"column":1},"end":{"line":78,"column":1}},"key":"H27KRSZDO4"}],"key":"aRQkRMxfZt"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":80,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"children":[{"type":"text","value":"The influence function should be bounded.","position":{"start":{"line":80,"column":1},"end":{"line":80,"column":1}},"key":"zEHkMcm3tn"}],"key":"xcyR0FdcZy"},{"type":"listItem","spread":true,"position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"The robust estimator should be unique, i.e. it should have a unique minimum. This implies that ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"j5TggpirWG"},{"type":"emphasis","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"the individual ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"lAyy5v9fzl"},{"type":"text","value":"ρ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"bPthYZOevf"},{"type":"text","value":"-function is convex in variable ","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"voxKFtrkMp"},{"type":"strong","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"children":[{"type":"text","value":"p","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"UizKLXnXfx"}],"key":"OlfLoRGmAb"}],"key":"d6HZXtqzND"},{"type":"text","value":".","position":{"start":{"line":81,"column":1},"end":{"line":81,"column":1}},"key":"BZ180OCw7N"}],"key":"suFVCykmvo"},{"type":"listItem","spread":true,"position":{"start":{"line":82,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"text","value":"The objective should have a gradient, even when the 2nd derivative is singular.","position":{"start":{"line":82,"column":1},"end":{"line":82,"column":1}},"key":"uXj3UUatym"}],"key":"PnBIKS71V3"}],"key":"IjL1vm2SSm"},{"type":"heading","depth":3,"position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"Common M-estimators","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"zeZibCnw1E"}],"identifier":"common-m-estimators","label":"Common M-estimators","html_id":"common-m-estimators","implicit":true,"key":"EvTYlJU6Qs"},{"type":"paragraph","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"Below we list some of the common estimators from the literature and which are available out of the box in GTSAM. We also provide accompanying graphs of the corresponding ","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"Ye4wjWdrOB"},{"type":"strong","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"ρ","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"f4eG1Vqg8A"},{"type":"text","value":" function","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"mT67BOblU7"}],"key":"rPdIX7Dk5B"},{"type":"text","value":", the ","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"ySr3eIMcZ7"},{"type":"strong","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"influence function","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"JNEmYSXpUx"}],"key":"fvVlF7gAqi"},{"type":"text","value":", and the ","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"qC0S6Y8j1A"},{"type":"strong","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"weight function","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"xVzqKO7c42"}],"key":"v3Fq3VpZMs"},{"type":"text","value":" in order, allowing one to visualize the differences and effects of each estimators influence function.","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"WOmtezuvZD"}],"key":"t0IGLaGr1n"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":88,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":88,"column":1},"end":{"line":90,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"Fair\n","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"xX0yXeU4Vm"},{"type":"image","url":"/fair-e30b7010a5142abb00abc5a27de15eb3.png","alt":"fair m-estimator","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"tI1jcfSxdc","urlSource":"/_static/robust_estimators/fair.png"}],"key":"NOnc49z6yC"}],"key":"zvYsnNy48y"},{"type":"listItem","spread":true,"position":{"start":{"line":91,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":91,"column":1},"end":{"line":92,"column":1}},"children":[{"type":"text","value":"Huber\n","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"ghmi9wFU34"},{"type":"image","url":"/huber-1faff682a5eb13ce8dc66d4c6f1ccd2d.png","alt":"huber m-estimator","position":{"start":{"line":91,"column":1},"end":{"line":91,"column":1}},"key":"tXD4fonz6X","urlSource":"/_static/robust_estimators/huber.png"}],"key":"UUXJmDM44K"}],"key":"XyMHvHQVP3"},{"type":"listItem","spread":true,"position":{"start":{"line":94,"column":1},"end":{"line":96,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":94,"column":1},"end":{"line":95,"column":1}},"children":[{"type":"text","value":"Cauchy\n","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"OEP6kkuPAb"},{"type":"image","url":"/cauchy-bea330bd5ba987b4bf3abf4645de5ba5.png","alt":"cauchy m-estimator","position":{"start":{"line":94,"column":1},"end":{"line":94,"column":1}},"key":"j8zkCgd8wt","urlSource":"/_static/robust_estimators/cauchy.png"}],"key":"ilMkuZfXtN"}],"key":"TU59hQm493"},{"type":"listItem","spread":true,"position":{"start":{"line":97,"column":1},"end":{"line":99,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":97,"column":1},"end":{"line":98,"column":1}},"children":[{"type":"text","value":"Geman-McClure\n","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"fZGmvWvf6V"},{"type":"image","url":"/gemanmcclure-313f141e4d1048821a010a352d0a28ad.png","alt":"geman-mcclure m-estimator","position":{"start":{"line":97,"column":1},"end":{"line":97,"column":1}},"key":"KQ7Tj655IZ","urlSource":"/_static/robust_estimators/gemanmcclure.png"}],"key":"yNcwkPhMmw"}],"key":"oueSFicBCt"},{"type":"listItem","spread":true,"position":{"start":{"line":100,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":100,"column":1},"end":{"line":101,"column":1}},"children":[{"type":"text","value":"Welsch\n","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"hN9zdRuEHF"},{"type":"image","url":"/welsch-fdb0e073153096295c05a147c01e0bef.png","alt":"welsch m-estimator","position":{"start":{"line":100,"column":1},"end":{"line":100,"column":1}},"key":"EmP5tdlcxM","urlSource":"/_static/robust_estimators/welsch.png"}],"key":"Gf2wk26SEl"}],"key":"Vl8Q60djWW"},{"type":"listItem","spread":true,"position":{"start":{"line":103,"column":1},"end":{"line":105,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":103,"column":1},"end":{"line":104,"column":1}},"children":[{"type":"text","value":"Tukey\n","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"b4GyaCgFiR"},{"type":"image","url":"/tukey-b71ead69af86e9ae48f7420e73330e59.png","alt":"tukey m-estimator","position":{"start":{"line":103,"column":1},"end":{"line":103,"column":1}},"key":"Ifwovisy0a","urlSource":"/_static/robust_estimators/tukey.png"}],"key":"jhFksPyLEf"}],"key":"dzHjcfdbr8"}],"key":"lLyakD5ksJ"},{"type":"heading","depth":2,"position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"children":[{"type":"text","value":"Example with Huber Noise Model","position":{"start":{"line":106,"column":1},"end":{"line":106,"column":1}},"key":"nkgGNU84ya"}],"identifier":"example-with-huber-noise-model","label":"Example with Huber Noise Model","html_id":"example-with-huber-noise-model","implicit":true,"key":"lwzx8vdyMZ"},{"type":"paragraph","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"Now it’s time for the real deal. So far we’ve spoken about how great robust estimators are, and how they can be easily modeled in a least squares objective, but having a concrete example and application can really help illuminate these concepts and demonstrate the power of a robust error model. In this specific case we use the ","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"Y56yqJxb2Y"},{"type":"strong","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"children":[{"type":"text","value":"Huber M-estimator","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"MFvSUyd5Cb"}],"key":"IudMcH7Saa"},{"type":"text","value":", though any other provided M-estimator can be used depending on the application or preference.","position":{"start":{"line":108,"column":1},"end":{"line":108,"column":1}},"key":"denZ5Uf1Uj"}],"key":"tp9cxgzPrL"},{"type":"paragraph","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"children":[{"type":"text","value":"For our example application, the estimation of an ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Bav0u5cNrY"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"y1U507biRX"},{"type":"text","value":" transformation between two objects (a scenario commonly seen in PoseSLAM applications), we go back to our image of the two books from the introduction, which we have manually labeled with matches and outliers. A RANSAC estimate using the matches gives us the ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"dr0i2toLpK"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"k0A2CZG1jx"},{"type":"text","value":" paramters ","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Me17eOH0QJ"},{"type":"inlineCode","value":"(347.15593, 420.31040, 0.39645)","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"YuhUmNk9Rd"},{"type":"text","value":".","position":{"start":{"line":110,"column":1},"end":{"line":110,"column":1}},"key":"Io85fgXhx5"}],"key":"qGHud1mMxo"},{"type":"container","class":"center","children":[{"type":"image","url":"/se2_matches-4738bfc995d1fff8cd708542094cec7a.png","alt":"Matches between books","key":"R1KmfcUhhQ","urlSource":"/_static/robust_estimators/se2_matches.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Figure 2","key":"mdf8ZkGLda"}],"key":"Hxz8rX0YBe"},{"type":"text","value":": Matches between the 2 books.","key":"WBvA2bsSFO"}],"key":"dkY6Pr8kKI"}],"key":"MpyKPT2FXZ"}],"enumerator":"2","key":"gjLpdKD1ki"},{"type":"paragraph","position":{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},"children":[{"type":"text","value":"To begin, we apply a straightforward optimization process based on Factor Graphs. Using GTSAM, this can be achieved in a few lines of code. We show the core part of the example below, omitting the housekeeping and data loading for brevity.","position":{"start":{"line":117,"column":1},"end":{"line":117,"column":1}},"key":"Xl4UlmJxrw"}],"key":"gWDPieuUzm"},{"type":"code","lang":"cpp","value":"// This is the value we wish to estimate\nPose2_ pose_expr(0);\n\n// Set up initial values, and Factor Graph\nValues initial;\nExpressionFactorGraph graph;\n\n// provide an initial estimate which is pretty much random\ninitial.insert(0, Pose2(1, 1, 0.01));\n\n// We assume the same noise model for all points (since it is the same camera)\nauto measurementNoise = noiseModel::Isotropic::Sigma(2, 1.0);\n\n// Now we add in the factors for the measurement matches.\n// Matches is a vector of 4 tuples (index1, keypoint1, index2, keypoint2)\nint index_i, index_j;\nPoint2 p, measurement;\nfor (vector<tuple<int, Point2, int, Point2>>::iterator it = matches.begin();\n    it != matches.end(); ++it) {\n\n    std::tie(index_i, measurement, index_j, p) = *it;\n\n    Point2_ predicted = transformTo(pose_expr, p);\n    \n    // Add the Point2 expression variable, an initial estimate, and the measurement noise.\n    graph.addExpressionFactor(predicted, measurement, measurementNoise);\n}\n\n// Optimize and print basic result\nValues result = LevenbergMarquardtOptimizer(graph, initial).optimize();\nresult.print(\"Final Result:\\n\");","position":{"start":{"line":119,"column":1},"end":{"line":151,"column":1}},"key":"VcO2D0VMa8"},{"type":"paragraph","position":{"start":{"line":153,"column":1},"end":{"line":154,"column":1}},"children":[{"type":"text","value":"It is important to note that our initial estimate for the transform values is pretty arbitrary.\nRunning the above code give us the transform values ","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"o2ao85Drs4"},{"type":"inlineCode","value":"(305.751, 520.127, 0.284743)","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"s7V5cR6BYo"},{"type":"text","value":", which when compared to the RANSAC estimate doesn’t look so good.","position":{"start":{"line":153,"column":1},"end":{"line":153,"column":1}},"key":"LxfxHKHZor"}],"key":"VP4z5ybVro"},{"type":"paragraph","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"children":[{"type":"text","value":"Now how about we try using M-estimators via the built-in robust error models? This is a two line change as illustrated below:","position":{"start":{"line":156,"column":1},"end":{"line":156,"column":1}},"key":"CFYjwUVt4h"}],"key":"TD2Pmoc2T8"},{"type":"code","lang":"cpp","value":"// This is the value we wish to estimate\nPose2_ pose_expr(0);\n\n// Set up initial values, and Factor Graph\nValues initial;\nExpressionFactorGraph graph;\n\n// provide an initial estimate which is pretty much random\ninitial.insert(0, Pose2(1, 1, 0.01));\n\n// We assume the same noise model for all points (since it is the same camera)\nauto measurementNoise = noiseModel::Isotropic::Sigma(2, 1.0);\n\n/********* First change *********/\n// We define our robust error model here, providing the default parameter value for the estimator.\nauto huber = noiseModel::Robust::Create(noiseModel::mEstimator::Huber::Create(1.345), measurementNoise);\n\n// Now we add in the factors for the measurement matches.\n// Matches is a vector of 4 tuples (index1, keypoint1, index2, keypoint2)\nint index_i, index_j;\nPoint2 p, measurement;\nfor (vector<tuple<int, Point2, int, Point2>>::iterator it = matches.begin();\n    it != matches.end(); ++it) {\n\n    std::tie(index_i, measurement, index_j, p) = *it;\n\n    Point2_ predicted = transformTo(pose_expr, p);\n\n    // Add the Point2 expression variable, an initial estimate, and the measurement noise.\n    // The graph takes in factors with the robust error model.\n    /********* Second change *********/\n    graph.addExpressionFactor(predicted, measurement, huber);\n}\n\n// Optimize and print basic result\nValues result = LevenbergMarquardtOptimizer(graph, initial).optimize();\nresult.print(\"Final Result:\\n\");","position":{"start":{"line":158,"column":1},"end":{"line":196,"column":1}},"key":"TiNtpyHTie"},{"type":"paragraph","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"children":[{"type":"text","value":"This version of the parameter estimation gives us the ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"N3SZpd6ZNh"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"t6Nb7f7AkY"},{"type":"text","value":" transform ","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"ppMhQDVFku"},{"type":"inlineCode","value":"(363.76, 458.966, 0.392419)","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"F1sd4ylZFA"},{"type":"text","value":". Quite close for only 15 total matches, especially considering 5 of the 10 were outliers! The estimates are expected to improve with more matches to further constrain the problem.","position":{"start":{"line":198,"column":1},"end":{"line":198,"column":1}},"key":"aQ7l56Crin"}],"key":"HrtJSzB9OO"},{"type":"paragraph","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"children":[{"type":"text","value":"As an alternate example, we look at an induced ","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"PXaoRevM0e"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"wtPUuiOefN"},{"type":"text","value":" transform and try to estimate it from scratch (no manual match labeling. Our source image is one of crayon boxes retrieved from the internet, since this image lends itself to good feature detection.","position":{"start":{"line":200,"column":1},"end":{"line":200,"column":1}},"key":"uCvUZJqMu2"}],"key":"OBI2orWPNL"},{"type":"image","url":"/original_image-1df85e31522589dcd3b3d73a5cf27f44.png","alt":"original image","position":{"start":{"line":202,"column":1},"end":{"line":202,"column":1}},"key":"QiT51zy3F3","urlSource":"/_static/robust_estimators/original_image.png"},{"type":"paragraph","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"children":[{"type":"text","value":"To model an ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"t8SsDNTfR8"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"ipEAM5Qor7"},{"type":"text","value":" transformation, we apply a perspective transform to the image. The transformation applied is ","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"BU4JSL7EpJ"},{"type":"inlineCode","value":"(x, y, theta) = (4.711, 3.702, 0.13963)","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"FeJHSQ56HG"},{"type":"text","value":". This gives us a ground truth value to compare our methods against. The transformed image can be seen below.","position":{"start":{"line":204,"column":1},"end":{"line":204,"column":1}},"key":"r5uMkD6elL"}],"key":"hVyXDjYBCO"},{"type":"image","url":"/transformed_image-b583c11169e4f8aa2f05ce20b164b6ee.png","alt":"Warped image","position":{"start":{"line":206,"column":1},"end":{"line":206,"column":1}},"key":"dDXGBIzP67","urlSource":"/_static/robust_estimators/transformed_image.png"},{"type":"paragraph","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"children":[{"type":"text","value":"We run the standard pipeline of SIFT feature extraction and FLANN+KDTree based matching to obtain a set of matches. At this point we are ready to evaluate the different methods of estimating the transformation.","position":{"start":{"line":208,"column":1},"end":{"line":208,"column":1}},"key":"xOdkTJaeaE"}],"key":"DN1xKKqYPw"},{"type":"paragraph","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"children":[{"type":"text","value":"The vanilla version of the parameter estimation gives us ","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"lw6tK4odSC"},{"type":"inlineCode","value":"(6.26294, -14.6573, 0.153888)","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"ggilBzkvm3"},{"type":"text","value":" which is pretty bad. However, the version with robust error models gives us ","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"QzK81O3RBD"},{"type":"inlineCode","value":"(4.75419, 3.60199, 0.139674)","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"qYbBUmtQEl"},{"type":"text","value":", which is a far better estimate when compared to the ground truth, despite the initial estimate for the transform being arbitrary. This makes it apparent that the use of robust estimators and subsequently robust error models is the way to go for use cases where outliers are a concern. Of course, providing better initial estimates will only improve the final estimate.","position":{"start":{"line":210,"column":1},"end":{"line":210,"column":1}},"key":"mMNbjPNc1s"}],"key":"PLW58AIpKI"},{"type":"paragraph","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"children":[{"type":"text","value":"You may ask how does this compare to our dear old friend RANSAC? Using the OpenCV implementation of RANSAC, a similar pipeline gives use the following ","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"IAw84JUJxF"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"b1nxzvYEqg"},{"type":"text","value":" values: ","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"z02su9GODy"},{"type":"inlineCode","value":"(4.77360, 3.69461, 0.13960)","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"LywvZO1uPd"},{"type":"text","value":".","position":{"start":{"line":212,"column":1},"end":{"line":212,"column":1}},"key":"FnDUvpagqu"}],"key":"WFPN6Zvjol"},{"type":"paragraph","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"children":[{"type":"text","value":"We show, in order, the original image, its warped form, and the recovered image from the ","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"C8TmsbRXSo"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"n1lgN3bZqd"},{"type":"text","value":" transformation estimation. The first image is from the ground truth transform, the second one is using RANSAC, the next one is using a vanilla parameter estimation approach, and the last one uses robust error models. As you can see, while the vanilla least-squares optimization result is poor compared to the ground truth, the RANSAC and the robust error model recover the transformation correctly, with the robust error model’s result being comparable to the RANSAC one.","position":{"start":{"line":214,"column":1},"end":{"line":214,"column":1}},"key":"mu3UMI6oIM"}],"key":"CUrOpqxdxj"},{"type":"container","class":"center","children":[{"type":"image","url":"/ground_truth_images-d47194fe3384d2f72825db060c6ac673.png","alt":"ground truth","key":"EBHLbyM3I1","urlSource":"/_static/robust_estimators/ground_truth_images.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"Image warping and recovery using ground truth SE(2) transform. The first image is the original image, the 2nd image is the transformed image, and the last one is the image we get on applying the reverse $SE(2)$ transform.","key":"niBXaO73cZ"}],"key":"Owr7CXtMB3"}],"key":"rioxOO6LhZ"}],"enumerator":"3","key":"gIkG5izlwI"},{"type":"container","class":"center","children":[{"type":"image","url":"/ransac_images-5df97053c669dea504a62cfc341f1967.png","alt":"ransac","key":"Hx5LY5sWUW","urlSource":"/_static/robust_estimators/ransac_images.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"Image warping and recovery using RANSAC.","key":"f8o8kwvFfK"}],"key":"j5s4nHr2TO"}],"key":"W4KXqqPSRp"}],"enumerator":"4","key":"pCRpjNTIVb"},{"type":"container","class":"center","children":[{"type":"image","url":"/vanilla_model_images-c49538cd83d93b780a67ac10c6c2704d.png","alt":"vanilla","key":"pM6d86v8Qu","urlSource":"/_static/robust_estimators/vanilla_model_images.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"Image warping and recovery using plain old parameter estimation. You can see that the 3rd (recovered) image does not line up correctly.","key":"uugntOM9zF"}],"key":"p1Vrwn3hqY"}],"key":"dDjBr5tb2r"}],"enumerator":"5","key":"c82SXBjEJB"},{"type":"container","class":"center","children":[{"type":"image","url":"/robust_model_images-fd92ade04ee7a6606787656b7dbc6e2a.png","alt":"robust error model","key":"WHRopugvRZ","urlSource":"/_static/robust_estimators/robust_model_images.png"},{"type":"caption","children":[{"type":"paragraph","children":[{"type":"text","value":"Image warping and recovery using robust error models with parameter estimation. These results are comparable to the ones from RANSAC, demonstrating the promise of robust error models.","key":"qHyg7CrXjX"}],"key":"vzulFqNL54"}],"key":"MX3card9D4"}],"enumerator":"6","key":"QwtN7lbM18"},{"type":"comment","value":" That's pretty close too, so why go through the headache of using robust error models? For one, unlike RANSAC, robust error models are deterministic and possess defined behavior. Moreover, one does not need to run multiple runs of optimization to obtain a consistent result, compared to RANSAC which may require hundreds of runs to converge to a good result. ","key":"ujcv3Zgce1"},{"type":"comment","value":" ## Robust Error Models + RANSAC ","key":"C32pCklMeV"},{"type":"heading","depth":2,"position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"children":[{"type":"text","value":"Conclusion","position":{"start":{"line":241,"column":1},"end":{"line":241,"column":1}},"key":"EXrlBk81L4"}],"identifier":"conclusion","label":"Conclusion","html_id":"conclusion","implicit":true,"key":"hcm9tVxYIh"},{"type":"paragraph","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"children":[{"type":"text","value":"In this post, we have seen the basics of parameter estimation, a ubiquitous mathematical framework for many perception and robotics problems, and we have seen how this framework is susceptible to perturbations from outliers which can throw off the final estimate. More importantly, we have seen how a simple tool called the Robust M-estimator can easily help us deal with these outliers and their effects. An example case for ","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"pgZtvvttMO"},{"type":"inlineMath","value":"SE(2)","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>S</mi><mi>E</mi><mo stretchy=\"false\">(</mo><mn>2</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">SE(2)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">SE</span><span class=\"mopen\">(</span><span class=\"mord\">2</span><span class=\"mclose\">)</span></span></span></span>","key":"akMDhUNboT"},{"type":"text","value":" transform estimation demonstrates not only their ease of use with GTSAM, but also the efficacy of the solution generated, especially when compared to widely used alternatives such as RANSAC.","position":{"start":{"line":243,"column":1},"end":{"line":243,"column":1}},"key":"bP20BGMtRA"}],"key":"StnfyF1UOO"},{"type":"paragraph","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"children":[{"type":"text","value":"Furthermore, robust estimators are deterministic, ameliorating the need for the complexity that comes inherent with RANSAC. While RANSAC is a great tool, robust error models provide us with a solid alternative to be considered. With the benefits of speed, accuracy, and ease of use, robust error models make a strong case for their adoption for many related problems and we hope you will give them a shot the next time you use GTSAM.","position":{"start":{"line":245,"column":1},"end":{"line":245,"column":1}},"key":"s6Uzrici6U"}],"key":"Le342xt6Fv"}],"key":"zItOxRHGKu"}],"key":"xSIbYyQqjs"},"references":{"cite":{"order":[],"data":{}}}}