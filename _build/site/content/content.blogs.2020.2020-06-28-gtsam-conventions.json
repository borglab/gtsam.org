{"version":1,"kind":"Article","sha256":"e058288feaad7ecb20e5ad57dcbdd8902107afd726502c274c6118fd66a921e0","slug":"content.blogs.2020.2020-06-28-gtsam-conventions","location":"/Content/Blogs/2020/2020-06-28-gtsam-conventions.md","dependencies":[],"frontmatter":{"title":"Geometry and Variable Naming Conventions","github":"https://github.com/borglab/gtsam","numbering":{"title":{"offset":2}},"edit_url":"https://github.com/borglab/gtsam/blob/docs/ktk-sdk/Content/Blogs/2020/2020-06-28-gtsam-conventions.md","exports":[{"format":"md","filename":"2020-06-28-gtsam-conventions.md","url":"/2020-06-28-gtsam-con-315ac9faca1190cdaa506a34f01feae8.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Author: ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AyXA2V6ezk"},{"type":"link","url":"https://samarth-robo.github.io","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Samarth Brahmbhatt","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"VOSDJqXzO0"}],"urlSource":"https://samarth-robo.github.io","key":"JiHblxG9y8"}],"key":"N2O0wnAKJ1"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"I am a post-doc at ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"kwDdlAalmm"},{"type":"link","url":"https://vladlen.info","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Intel ISL","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"DzlnmjKOPG"}],"urlSource":"https://vladlen.info","key":"EYNcQrAg6Y"},{"type":"text","value":". In my\n","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"nKRdRa2Fqb"},{"type":"link","url":"https://contactpose.cc.gatech.edu","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"PhD work","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"tGbRgjluFH"}],"urlSource":"https://contactpose.cc.gatech.edu","key":"mmQNMoqzHM"},{"type":"text","value":", I used GTSAM for object pose\nestimation and 3D reconstruction of hand joints to study hand-object interaction.\nI love GTSAM for its ability to optimize geometric quantities and deal with\nuncertainty in observations. However, it is easy to get lost in the web of\ninverse transformations while optimizing complex geometric systems. I’ve found\nthat naming code variables consistently with textbook notation conventions can\nhelp mitigate this. This post describes some suggestions for doing that.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ifq4b7nopp"}],"key":"gqiSwmiT9Q"},{"type":"heading","depth":2,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Points","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"MnGusVRyZ0"}],"identifier":"points","label":"Points","html_id":"points","implicit":true,"key":"ZUWBzUJKND"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":18,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Always name your 3D points like how you would on paper. A point ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"p9J3nJsee3"},{"type":"superscript","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"cX","key":"A3wn2oCi1t"}],"key":"tBnr5a80dE"},{"type":"text","value":" in the\ncamera coordinate system ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"sDliSMiCQ8"},{"type":"inlineMath","value":"c","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span>","key":"Fl6dPShlDH"},{"type":"text","value":" is named ","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"reVMPR3w55"},{"type":"inlineCode","value":"cX","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"XTfcSiKFr4"},{"type":"text","value":".","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"pbbmVuc5Yf"}],"key":"M4A0EmuGtt"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"3D points use uppercase letters, 2D points use lowercase letters.","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"LWvcb7MBCI"}],"key":"br8lo4sKQf"}],"key":"v823pXgNvN"},{"type":"heading","depth":2,"position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Pose","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"atIaGb2y8V"}],"identifier":"pose","label":"Pose","html_id":"pose","implicit":true,"key":"bUxiy3bSyR"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Name your pose variables like how you would write them on paper.\nThe pose ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"OqfNqjaT63"},{"type":"inlineMath","value":"^wT_c","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mi>w</mi></msup><msub><mi>T</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">^wT_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"Q6urhpGO04"},{"type":"text","value":" of camera coordinate frame ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"gd9OEWQR08"},{"type":"inlineMath","value":"c","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span>","key":"JxpjbghNCM"},{"type":"text","value":" in the world coordinate frame\n","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"hMfjn2BNmk"},{"type":"inlineMath","value":"w","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>w</mi></mrow><annotation encoding=\"application/x-tex\">w</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02691em;\">w</span></span></span></span>","key":"HR32Oom6q1"},{"type":"text","value":" is named ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"LT2vvDZpvl"},{"type":"inlineCode","value":"wTc","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"aNDvTzXIid"},{"type":"text","value":". In GTSAM jargon, ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"o1XNWWrdie"},{"type":"inlineCode","value":"c","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Ptq8pt5JRQ"},{"type":"text","value":" is the ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"Ky7aPzPdQy"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"pose coordinate","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"JRdcupR5GP"}],"key":"q1VYfEgNOD"},{"type":"text","value":" frame,\nand ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"mbAazMrler"},{"type":"inlineCode","value":"w","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"oaAAtLvgcS"},{"type":"text","value":" is the ","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"AWTyJmsoyy"},{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"world coordinate","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"EAVsdRMYlR"}],"key":"MyUQsmORPu"},{"type":"text","value":" frame.","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"azgpjYrIjG"}],"key":"ZfNe1jBvvG"},{"type":"heading","depth":2,"position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Composing Poses","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"pD0AP1A536"}],"identifier":"composing-poses","label":"Composing Poses","html_id":"composing-poses","implicit":true,"key":"GO405OhVk4"},{"type":"paragraph","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"children":[{"type":"text","value":"Math: ","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"GCWjSWMgS0"},{"type":"inlineMath","value":"^oT_c =~^oT_w~\\cdot~^wT_c","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mi>o</mi></msup><msub><mi>T</mi><mi>c</mi></msub><mo>=</mo><msup><mtext> </mtext><mi>o</mi></msup><msub><mi>T</mi><mi>w</mi></msub><mtext> </mtext><mo>⋅</mo><msup><mtext> </mtext><mi>w</mi></msup><msub><mi>T</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">^oT_c =~^oT_w~\\cdot~^wT_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">o</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mspace nobreak\"> </span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">o</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace nobreak\"> </span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mspace nobreak\"> </span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"wdj8IsMONu"},{"type":"text","value":".","position":{"start":{"line":29,"column":1},"end":{"line":29,"column":1}},"key":"zq07Z2hvYc"}],"key":"SDQK229wLi"},{"type":"paragraph","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"GTSAM code:","position":{"start":{"line":31,"column":1},"end":{"line":31,"column":1}},"key":"si7imdDffK"}],"key":"pZ3CP6T7Te"},{"type":"code","lang":"cpp","value":"Pose3 oTw = Pose3(...);\nPose3 wTc = Pose3(...);\nPose3 oTc = oTw * wTc;\n// same as Pose3 oTc = oTw.compose(wTc);","position":{"start":{"line":32,"column":1},"end":{"line":37,"column":1}},"key":"i4u4YYfU9U"},{"type":"heading","depth":2,"position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Transforming Points ","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"T4y5MjQjv4"},{"type":"emphasis","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"From","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"ARqOIO5iQq"}],"key":"dmLthRw0M5"},{"type":"text","value":" Pose Coordinates","position":{"start":{"line":39,"column":1},"end":{"line":39,"column":1}},"key":"BL4e2Ulh7x"}],"identifier":"transforming-points-from-pose-coordinates","label":"Transforming Points From Pose Coordinates","html_id":"transforming-points-from-pose-coordinates","implicit":true,"key":"vod5axWqMq"},{"type":"paragraph","position":{"start":{"line":40,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"This operation uses the camera pose in the world coordinate frame\n(","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"JaxysljUnr"},{"type":"inlineMath","value":"^wT_c","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mi>w</mi></msup><msub><mi>T</mi><mi>c</mi></msub></mrow><annotation encoding=\"application/x-tex\">^wT_c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"xtwSx8cALT"},{"type":"text","value":") to bring points from the camera coordinate frame (","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"R5VGJM5ZFh"},{"type":"inlineMath","value":"^c\\homo{X}","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 3: ^c\\̲h̲o̲m̲o̲{X}","key":"wzI3alSVPZ"},{"type":"text","value":") to\nthe world coordinate frame (","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"loJtQIm51z"},{"type":"inlineMath","value":"^w\\homo{X}","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 3: ^w\\̲h̲o̲m̲o̲{X}","key":"e88LQw8diO"},{"type":"text","value":").","position":{"start":{"line":40,"column":1},"end":{"line":40,"column":1}},"key":"eneOetrkr1"}],"key":"mtXVSiad5R"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Math: ","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"PTMGKbTFZD"},{"type":"inlineMath","value":"^w\\homo{X} =~^wT_c~\\cdot~^c\\homo{X}","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 3: ^w\\̲h̲o̲m̲o̲{X} =~^wT_c~\\cd…","key":"jfi8L3ICOT"}],"key":"YuQbFAy8zL"},{"type":"paragraph","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"children":[{"type":"text","value":"GTSAM Code:","position":{"start":{"line":46,"column":1},"end":{"line":46,"column":1}},"key":"L4TCvmtOjx"}],"key":"uBDmTDhyXY"},{"type":"code","lang":"cpp","value":"Point3 wX = wTc.transformFrom(cX);\n// same as Point3 wX = wTc * cX;","position":{"start":{"line":47,"column":1},"end":{"line":50,"column":1}},"key":"bp0kC8nyfR"},{"type":"heading","depth":2,"position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"Transforming Points ","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"e4F9Bpbg8L"},{"type":"emphasis","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"To","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"ZEkXPXSdxS"}],"key":"XbIZ9uqD8x"},{"type":"text","value":" Pose Coordinates","position":{"start":{"line":52,"column":1},"end":{"line":52,"column":1}},"key":"UJzz1YjeGS"}],"identifier":"transforming-points-to-pose-coordinates","label":"Transforming Points To Pose Coordinates","html_id":"transforming-points-to-pose-coordinates","implicit":true,"key":"pZJ9TeFYbV"},{"type":"paragraph","position":{"start":{"line":53,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"This operation uses the inverse of the camera pose ","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"nsf3lXjFcp"},{"type":"inlineMath","value":"\\left(^wT_c\\right)^{-1}","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow><mo fence=\"true\">(</mo><msup><mrow></mrow><mi>w</mi></msup><msub><mi>T</mi><mi>c</mi></msub><mo fence=\"true\">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">\\left(^wT_c\\right)^{-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.204em;vertical-align:-0.25em;\"></span><span class=\"minner\"><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\">(</span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\">)</span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.954em;\"><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span>","key":"o8Z1q32FSx"},{"type":"text","value":"\nto bring points from the world coordinate frame (","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"n27Ghmhbht"},{"type":"inlineMath","value":"^w\\homo{X}","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 3: ^w\\̲h̲o̲m̲o̲{X}","key":"ol0bnEnMpp"},{"type":"text","value":") to\nthe camera coordinate frame (","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"cIjjiYrWIW"},{"type":"inlineMath","value":"^c\\homo{X}","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 3: ^c\\̲h̲o̲m̲o̲{X}","key":"TZ50QFMzow"},{"type":"text","value":").","position":{"start":{"line":53,"column":1},"end":{"line":53,"column":1}},"key":"rhBn1yhx6G"}],"key":"xlvv1J0Bea"},{"type":"paragraph","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"children":[{"type":"text","value":"Math: ","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"key":"hluEeBtHfQ"},{"type":"inlineMath","value":"^c\\homo{X} =~\\left(^wT_c\\right)^{-1}~\\cdot~^w\\homo{X}","position":{"start":{"line":57,"column":1},"end":{"line":57,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 3: ^c\\̲h̲o̲m̲o̲{X} =~\\left(^wT…","key":"vg5kZneyUw"}],"key":"bqmX6WNk10"},{"type":"paragraph","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"children":[{"type":"text","value":"GTSAM Code:","position":{"start":{"line":59,"column":1},"end":{"line":59,"column":1}},"key":"zf4pnMn8aI"}],"key":"PwYwEikfHc"},{"type":"code","lang":"cpp","value":"Point3 cX = wTc.transformTo(wX);","position":{"start":{"line":60,"column":1},"end":{"line":62,"column":1}},"key":"jQawU4hhUO"},{"type":"heading","depth":2,"position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"Cameras","position":{"start":{"line":64,"column":1},"end":{"line":64,"column":1}},"key":"D4bOrUnZay"}],"identifier":"cameras","label":"Cameras","html_id":"cameras","implicit":true,"key":"FhnZ15dSr3"},{"type":"paragraph","position":{"start":{"line":65,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"The GTSAM pinhole camera classes\n(e.g. ","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"L1AGv0l9gw"},{"type":"link","url":"https://github.com/borglab/gtsam/blob/develop/gtsam/geometry/CalibratedCamera.cpp","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"children":[{"type":"inlineCode","value":"PinholeBase","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"JseP1HPJjl"}],"urlSource":"https://github.com/borglab/gtsam/blob/develop/gtsam/geometry/CalibratedCamera.cpp","data":{"kind":"file","org":"borglab","repo":"gtsam","reference":"develop","file":"gtsam/geometry/CalibratedCamera.cpp","raw":"https://raw.githubusercontent.com/borglab/gtsam/develop/gtsam/geometry/CalibratedCamera.cpp"},"internal":false,"protocol":"github","key":"x77JhGgY7w"},{"type":"text","value":")\ninternally use ","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"ApXqKjlDAE"},{"type":"inlineCode","value":"transformTo()","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"NZPhd8sS4K"},{"type":"text","value":" to transform 3D points into the camera\ncoordinates, so you should use the pose of the camera w.r.t. world while\nconstructing the object:","position":{"start":{"line":65,"column":1},"end":{"line":65,"column":1}},"key":"KlXoR3IEdl"}],"key":"FhjB8BDXwY"},{"type":"code","lang":"cpp","value":"Pose3 wTc = Pose3(...);\nSimpleCamera cam(wTc, K);","position":{"start":{"line":70,"column":1},"end":{"line":73,"column":1}},"key":"wM2LjiUhN0"},{"type":"paragraph","position":{"start":{"line":74,"column":1},"end":{"line":78,"column":1}},"children":[{"type":"text","value":"now you can use ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"NyeeweuGvr"},{"type":"inlineCode","value":"cam","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"qMNyd0CMY5"},{"type":"text","value":" in the ","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"Qu7CIxuoV2"},{"type":"inlineCode","value":"TriangulationFactor","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"gkljjgKQbD"},{"type":"text","value":" for example. Other factors\nlike the\n","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"BgiL4gUW0Q"},{"type":"link","url":"https://github.com/borglab/gtsam/blob/develop/gtsam/slam/ProjectionFactor.h","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"inlineCode","value":"GenericProjectionFactor","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"PLhGhA4mmG"}],"urlSource":"https://github.com/borglab/gtsam/blob/develop/gtsam/slam/ProjectionFactor.h","data":{"kind":"file","org":"borglab","repo":"gtsam","reference":"develop","file":"gtsam/slam/ProjectionFactor.h","raw":"https://raw.githubusercontent.com/borglab/gtsam/develop/gtsam/slam/ProjectionFactor.h"},"internal":false,"protocol":"github","key":"e9jOSI4m1a"},{"type":"text","value":"\nalso use the same convention:\n$$","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"SsESXlUVHd"}],"key":"FZpJpRMfSv"},{"type":"math","value":"\\begin{align*}\n^{sensor}\\homo{X}\n&=~^{sensor}T_{world}~\\cdot~^{world}\\homo{X}\\\\\n&=~^{sensor}T_{body}~\\cdot~^{body}T_{world}~\\cdot~^{world}\\homo{X}\\\\\n&= \\left(^{world}T_{body}~\\cdot~^{body}T_{sensor}\\right)^{-1}~\\cdot~^{world}\\homo{X}\n\\end{align*}","tight":true,"position":{"start":{"line":79,"column":1},"end":{"line":83,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 25: …ign*}\n^{sensor}\\̲h̲o̲m̲o̲{X}\n&=~^{sensor…","enumerator":"1","key":"A1H5Ndpcik"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"$$","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"vhKSyjUOs9"}],"key":"rZ2NLbHqGR"},{"type":"paragraph","position":{"start":{"line":87,"column":1},"end":{"line":91,"column":1}},"children":[{"type":"strong","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"Example","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"SphJ1zn6we"}],"key":"E1ranhM9lL"},{"type":"text","value":": In a mobile robot SLAM scenario, wheel odometry might tell you where\nthe robot body is in the world (","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"rXLZxSjJVX"},{"type":"inlineMath","value":"^{world}T_{body}","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mrow><mi>w</mi><mi>o</mi><mi>r</mi><mi>l</mi><mi>d</mi></mrow></msup><msub><mi>T</mi><mrow><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">^{world}T_{body}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.1352em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02691em;\">w</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">or</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal mtight\">d</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span></span></span></span>","key":"XlGSrWXjFd"},{"type":"text","value":"), and the robot URDF spec\nmight tell you where the camera is on the robot body (","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"l2NvcVR7e4"},{"type":"inlineMath","value":"^{body}T_{sensor}","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mrow></mrow><mrow><mi>b</mi><mi>o</mi><mi>d</mi><mi>y</mi></mrow></msup><msub><mi>T</mi><mrow><mi>s</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>o</mi><mi>r</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">^{body}T_{sensor}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.9991em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span></span></span></span></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">T</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">se</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">sor</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span>","key":"C2LRpvZMEE"},{"type":"text","value":").\nTogether, these allow you to situate camera observations in the world coordinate\nframe.","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"tcqUJB7Yyg"}],"key":"e9OE3QIjZv"},{"type":"paragraph","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"children":[{"type":"text","value":"GTSAM Code:","position":{"start":{"line":93,"column":1},"end":{"line":93,"column":1}},"key":"WdrxI4AgRq"}],"key":"gS6LGdXsEF"},{"type":"code","lang":"cpp","value":"Pose3 body_T_sensor = ...\nPoint2 sensor_p = ...  // 2D point in the image\n// in the following factor,\n// Symbol('T', i) is world_T_body for the i'th frame\n// Symbol('X', j) is the j'th 3D point in world coordinates i.e. world_Xj\nauto f = GenericProjectionFactor<Pose3, Point3, Cal3_S2>(sensor_p, noise, Symbol('T', i), Symbol('X', j), K, body_T_sensor);","position":{"start":{"line":94,"column":1},"end":{"line":101,"column":1}},"key":"jWCc8XlyOj"},{"type":"paragraph","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"children":[{"type":"text","value":"It will project the world 3D point ","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"iID6Kp603w"},{"type":"inlineMath","value":"^{world}\\homo{X}","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"error":true,"message":"Undefined control sequence: \\homo at position 9: ^{world}\\̲h̲o̲m̲o̲{X}","key":"hBSbcMxrgV"},{"type":"text","value":" into the sensor coordinates like so:","position":{"start":{"line":102,"column":1},"end":{"line":102,"column":1}},"key":"Y9Y2gLzhgP"}],"key":"HBd6WPgQiH"},{"type":"code","lang":"cpp","value":"Pose3 world_T_sensor = world_T_body * body_T_sensor;\nPoint3 sensor_X = world_T_sensor.transformTo(world_X);","position":{"start":{"line":103,"column":1},"end":{"line":106,"column":1}},"key":"Kscn1TKFxX"},{"type":"paragraph","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"children":[{"type":"text","value":"and then project it to the image using instrinsics and then compare it to the detection ","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"SVcOOUI2lk"},{"type":"inlineCode","value":"sensor_p","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"QRqcqR1K3D"},{"type":"text","value":".","position":{"start":{"line":107,"column":1},"end":{"line":107,"column":1}},"key":"YJQ1808x9A"}],"key":"vh8Qgf3kdY"}],"key":"aZq5XEPZta"}],"key":"WiXQ1dXJVc"},"references":{"cite":{"order":[],"data":{}}}}